define("eform-lang/type",[],function(){function e(e){if(null==e)return e+"";if("object"==typeof e||"function"==typeof e)return t[n.call(e)]||"object";else return typeof e}var t={},n=t.toString;return"Boolean Number String Function Array Date RegExp Object Error".replace(/\w+/g,function(e){t["[object "+e+"]"]=e.toLowerCase()}),e}),define("eform-lang/each",["require","./type"],function(require){function e(e,n){var r,i;if("array"===t(e)){i=0;for(var o=e.length;o>i&&(r=n.call(e[i],i,e[i]),r!==!1);i++);}else for(i in e)if(e.hasOwnProperty(i))if(r=n.call(e[i],i,e[i]),r===!1)break;return e}var t=require("./type");return e}),define("eform-lang/expando",[],function(){function e(e){return e+t+n}var t=+new Date,n=(Math.random()+"").slice(2);return e}),define("eform-lang/extend",[],function(){function e(e,t){e=e||{};var n=1;if(arguments.length===n)return e;for(;n<arguments.length;n++)if(t=arguments[n],null!=t)for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r];return e}return e}),define("eform-emitter/HandlerObject",[],function(){function e(e){var t=n.exec(e),r=t[2]?t[2].split(".").sort():[];return r.type=t[1],r}function t(t,n,r,i,o){var a=e(t);this.type=a.type,this.namespace=a.join("."),this.handler=n,this.one=!!o,this.data=r,this.selector=i}var n=/^([^.]*)(?:\.(.+)|)$/;return t.prototype={constructor:t,validate:function(e,t,n,r){return!(e&&e!==this.type||t&&t!==this.handler||n&&!n.test(this.namespace)||r&&r!==this.selector&&("**"!==r||!this.selector))},packNamespace:function(){return this.namespace?new RegExp("(^|\\.)"+this.namespace.replace(".","\\.(?:.*\\.|)")+"(\\.|$)"):null}},t}),define("eform-emitter/HandlerQueue",[],function(){function e(e,t,n){this.element=e,this.delegate=0,this.matches=t||null,this.parent=n||null,this.handlers=[]}return e.prototype={constructor:e,add:function(e){var t=this.handlers;if(e.selector)t.splice(this.delegate++,0,e);else t.push(e)},remove:function(e,t,n,r){for(var i=this.handlers,o=i.length,a="string"!=typeof e;o--;){var s=i[o];if(a&&s===e||s.validate(e,t,n,r))if(i.splice(o,1),s.selector)this.delegate--}return this.isEmpty()},isEmpty:function(){return!this.handlers.length},queue:function(e){var t=this.element,n=this.handlers,r=[],i=e.target,o=this.delegate;if(o&&this.parent&&this.matches)for(;i!==t;i=i[this.parent]||t){for(var a=[],s={},l=0;o>l;l++){var u=n[l],c=u.selector+"";if(void 0===s[c])s[c]=this.matches(i,c,t);if(s[c])a.push(u)}if(a.length)r.push({elem:i,handlers:a})}if(o<n.length)r.push({elem:t,handlers:n.slice(o)});return r}},e}),define("eform-emitter/emitter",["require","eform-lang/each","eform-lang/expando","eform-lang/extend","./HandlerObject","./HandlerQueue"],function(require){function e(){}var t=require("eform-lang/each"),n=require("eform-lang/expando"),r=require("eform-lang/extend"),i=require("./HandlerObject"),o=require("./HandlerQueue"),a=[].slice,s=n("eform-emitter"),l=e.prototype;return r(l,{on:function(e,t,n){var r=this,a=r[s]=r[s]||{};return e.replace(/\S+/g,function(e){var s=new i(e,t,null,null,n);e=s.type,a[e]=a[e]||new o(r),a[e].add(s)}),this},once:function(e,t){return this.on(e,t,!0)},off:function(e,n){var r,o=this;if(!e||!(r=o[s]))return delete o[s],o;else return e.replace(/\S+/g,function(e){var a=new i(e),s=a.type;if(!s)return void t(r,function(t){l.off.call(o,t+e,n)});var u;if(u=r[s]){var c=a.packNamespace();if(!c&&!n)return void delete r[s];if(u.remove(s,n,c,null))delete r[s]}}),o},emit:function(e,t){var n=new i(e);e=n.type;var r=n.packNamespace();t=a.call(arguments,1);var o="on"+e;if(this[o])this[o].apply(this,t);var l;if(this[s]&&(l=this[s][e])){for(var u=0;u<l.handlers.length;u++){var c=l.handlers[u];if(!r||r.test(c.namespace)){if(c.one)l.remove(c);c.handler.apply(this,t)}}if(l.isEmpty())delete this[s][e]}return this}}),l.bind=l.on,l.one=l.once,l.un=l.off,l.fire=l.trigger=l.emit,e.mixin=function(e){return t(l,function(t,n){e[t]=n}),e},e}),define("eform-emitter",["eform-emitter/emitter"],function(e){return e}),define("eform-lang/guid",[],function(){function e(e){return(e||"")+t++}var t=1;return e}),define("eform-lang/clone",["require","./each","./type"],function(require){function e(i,o){if(null==i||"object"!=typeof i)return i;var a=n(i);if(r.test(a))return i.valueOf();if("date"===a)return new Date(+i);var s="array"===a?[]:"error"===a?new Error:{};return t(i,function(t,n){s[t]=o?e(n,!0):n}),s}var t=require("./each"),n=require("./type"),r=/^(?:number|string|boolean|regexp)$/;return e}),define("data/storage",[],function(){var e=window.localStorage,t={};return{getItem:function(n){return n in t?t[n]:JSON.parse(e.getItem(n))},setItem:function(n,r){if(null==r)r=null;e.setItem(n,JSON.stringify(t[n]=r))},removeItem:function(n){delete t[n],e.removeItem(n)},clear:function(){t={},e.clear()}}}),define("data/category",["require","eform-lang/guid","eform-lang/each","eform-lang/extend","eform-lang/clone","eform-lang/expando","eform-emitter","./storage"],function(require){function e(){f={},d={},n(c,function(e,t){f[t.id]=e;var n=t.parent;if(null==n)d[t.id]=d[t.id]||{};else d[n]=d[n]||{},d[n][t.id]=!0}),l.setItem("categories",c)}var t=require("eform-lang/guid"),n=require("eform-lang/each"),r=require("eform-lang/extend"),i=require("eform-lang/clone"),o=require("eform-lang/expando"),a=require("eform-emitter"),s={};a.mixin(s);var l=require("./storage"),u=o("category").slice(0,17),c=l.getItem("categories")||[{id:"category0",title:"默认分类",readonly:!0,order:0,parent:null}],f=null,d=null;return e(),s.item=function(e){return c[f[e]]},s.insert=function(n,r){var o={id:t(u),title:n,readonly:!1,order:0,parent:r||null};return c.push(o),e(),s.emit("add",o=i(o)),o},s.update=function(t,n){t=t||n.id;var o=f[t];if(null==o)c.push(n);else n=r(c[o],n);return e(),s.emit("update",n=i(n)),n},s.remove=function(t){var r=f[t];if(null==r)return null;var i=[r];n(d[t],function(e){i.push(f[e])}),i.sort(function(e,t){return t-e});var o=[];return n(i,function(e,t){o.push.apply(o,c.splice(t,1))}),e(),s.emit("remove",o),o},s.query=function(e,t,r){var o=[];if(e)n(d[e],function(e){o.push(i(c[f[e]]))});else if(!r)o=i(c,!0);else n(d,function(e){var n=i(c[f[e]]);n.children=s.query(e,t,!1),o.push(n)});if(t)o.sort(function(e,t){var n=t.order-e.order,r=+e.id.slice("11"),i=+t.id.slice("11");return n?n:i-r});return o},s}),define("data/task",["require","eform-lang/guid","eform-lang/each","eform-lang/clone","eform-lang/expando","eform-lang/extend","eform-emitter","./category","./storage"],function(require){function e(){d={},p={},m={},n(f,function(e,t){d[t.id]=e;var n=t.category;p[n]=p[n]||{},p[n][t.id]=!0,m[n]=m[n]||0,m[n]++}),u.setItem("tasks",f)}var t=require("eform-lang/guid"),n=require("eform-lang/each"),r=require("eform-lang/clone"),i=require("eform-lang/expando"),o=require("eform-lang/extend"),a=require("eform-emitter"),s=require("./category"),l={};a.mixin(l);var u=require("./storage"),c=i("task").slice(0,17),f=u.getItem("tasks")||[],d=null,p=null,m=null;return e(),l.item=function(e){return f[d[e]]},l.insert=function(n,i,o,a){var s={id:t(c),title:n||"",date:i||"",content:o||"",finished:!1,category:a||"category0"};return f.push(s),e(),l.emit("add",s=r(s)),s},l.update=function(t,n){var i=t||n.id,a=d[i];if(null==a)f.push(n);else n=o(f[a],n);return e(),l.emit("update",n=r(n)),n},l.remove=function(t){var n=d[t];if(null==n)return null;var r=f.splice(n,1)[0];return e(),l.emit("remove",r),r},l.query=function(e,t,i){var o=[];if(n(e?p[e]:d,function(e){var n=f[d[e]];if(!("finished"===t&&!n.finished||"unfinished"===t&&n.finished))o.push(r(n))}),i)o.sort(function(e,t){var n=e.date.split("-"),r=t.date.split("-"),i=new Date(r[0],r[1],r[2])-new Date(n[0],n[1],n[2]);return i?i:t.id.localeCompare(e.id)});return o},l.count=function(e){return e?m[e]||0:f.length},s.on("remove",function(t){n(t,function(e,t){var r=l.query(t.id,null,!1);n(r,function(e,t){f[d[t.id]].category=t.category="category0"})}),l.emit("reload"),e()}),l}),define("category/model",["require","eform-lang/each","../data/category","../data/task","eform-emitter"],function(require){var e=require("eform-lang/each"),t=require("../data/category"),n=require("../data/task"),r={},i=require("eform-emitter");return i.mixin(r),r.getCategories=function(){var i=!1,o=!1;if(r.current){var a=t.item(r.current);if(a.parent)i=a.parent,o=a.id;else i=a.id}var s={count:0,currentFirst:i,currentSecond:o,categories:t.query(null,!0,!0)};return e(s.categories,function(t,r){r.count=n.count(r.id),e(r.children,function(e,t){t.count=n.count(t.id),r.count+=t.count}),s.count+=r.count}),s},r.addCategory=function(e){var n=r.current;if(!n||"category0"===n)return t.insert(e,null);var i=t.item(n);if(null==i.parent)return t.insert(e,i.id);else return t.insert(e,i.parent)},r.removeCategory=function(n){var i=t.remove(n),o=r.current;return e(i,function(e,t){if(t.id===r.current)r.current=null}),o!==r.current},r.setCurrentCategory=function(e){var t=r.current;return r.current=e,t!==r.current},r.getCurrentCategory=function(){return r.current||null},n.on("add update remove",function(){r.emit("change")}),r}),function(e){function t(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}function n(){this.raw=[],this.length=0}function r(){return"___"+R++}function i(e,t){var n=new Function;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function o(e){return A[e]}function a(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function s(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return"\\"+e})}function l(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,n){return t[n-0+1]})}function u(e){return e=e.replace(/^\s*\*/,""),l('gv({0},["{1}"])',a(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function c(e,t,n,r,i,o){for(var a=n.length,s=e.split(t),l=0,u=[],c=0,f=s.length;f>c;c++){var d=s[c];if(c){var p=1;for(l++;;){var m=d.indexOf(n);if(0>m){u.push(l>1&&p?t:"",d);break}if(l=r?l-1:0,u.push(l>0&&p?t:"",d.slice(0,m),l>0?n:""),d=d.slice(m+a),p=0,0===l)break}if(0===l)i(u.join("")),o(d),u=[]}else d&&o(d)}if(l>0&&u.length>0)o(t),o(u.join(""))}function f(e,t,n){var r,i=[],o=t.options,s="",l="",d="",p="";if(n)s="ts(",l=")",d=B,p=L,r=o.defaultFilter;return c(e,o.variableOpen,o.variableClose,1,function(e){if(n&&e.indexOf("|")<0&&r)e+="|"+r;var o=e.indexOf("|"),a=(o>0?e.slice(0,o):e).replace(/^\s+/,"").replace(/\s+$/,""),c=o>0?e.slice(o+1):"",m=0===a.indexOf("*"),h=[m?"":s,u(a),m?"":l];if(c){c=f(c,t);for(var g=c.split("|"),v=0,y=g.length;y>v;v++){var b=g[v];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(b)){if(h.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)h.push(",",RegExp.$3);h.push(")")}}}i.push(d,h.join(""),p)},function(e){i.push(d,n?a(e):e,p)}),i.join("")}function d(e,t){this.value=e,this.engine=t}function p(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[]}function m(e,t){var n=e.stack,r=t?n.find(function(e){return e instanceof t}):n.bottom();if(r){for(var i;(i=n.top())!==r;){if(!i.autoClose)throw new Error(i.type+" must be closed manually: "+i.value);i.autoClose(e)}r.close(e)}return r}function h(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,p.call(this,e,t),this.blocks={}}function g(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,p.call(this,e,t),this.cloneProps=["name"]}function v(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,p.call(this,e,t),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,p.call(this,e,t),this.cloneProps=["name","expr"]}function b(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,p.call(this,e,t),this.cloneProps=["name","args"]}function w(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,p.call(this,e,t),this.cloneProps=["name","args"]}function E(e,t){var n=new RegExp(l("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",s(t.options.variableOpen),s(t.options.variableClose)),"i");if(!n.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,p.call(this,e,t),this.cloneProps=["list","item","index"]}function k(e,t){p.call(this,e,t)}function x(e,t){k.call(this,e,t)}function C(e,t){p.call(this,e,t)}function T(e,t){t.target=e;var n=t.engine,r=e.name;if(n.targets[r])switch(n.options.namingConflict){case"override":n.targets[r]=e,t.targets.push(r);case"ignore":break;default:throw new Error("Target exists: "+r)}else n.targets[r]=e,t.targets.push(r)}function $(e,t){q[e]=t,t.prototype.type=e}function N(e){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.targets={},this.filters=t({},I)}function D(e,t){function r(){var e;if(f.length>0&&(e=f.join(""))){var n=new d(e,t);if(n.beforeAdd(u),l.top().addChild(n),f=[],t.options.strip&&u.current instanceof p)n.value=e.replace(/^[\x20\t\r]*\n/,"");u.current=n}}var i,o=t.options.commandOpen,a=t.options.commandClose,s=t.options.commandSyntax,l=new n,u={engine:t,targets:[],stack:l,target:null},f=[];return c(e,o,a,0,function(e){var n=s.exec(e);if(n&&(i=q[n[2].toLowerCase()])&&"function"==typeof i){r();var l=u.current;if(t.options.strip&&l instanceof d)l.value=l.value.replace(/\r?\n[\x20\t]*$/,"\n");if(n[1])l=m(u,i);else{if(l=new i(n[3],t),"function"==typeof l.beforeOpen)l.beforeOpen(u);l.open(u)}u.current=l}else if(!/^\s*\/\//.test(e))f.push(o,e,a);i=null},function(e){f.push(e)}),r(),m(u),u.targets}n.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var n=this.raw[t];if(e(n))return n}}};var R=178245,A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},I={html:function(e){return e.replace(/[&<>"']/g,o)},url:encodeURIComponent,raw:function(e){return e}},S='var r="";',B="r+=",L=";",M="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)S="var r=[],ri=0;",B="r[ri++]=",M='return r.join("");';d.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return f(e,this.engine,1)},clone:function(){return this}},p.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this)},close:function(e){if(e.stack.top()===this)e.stack.pop()},getRendererBody:function(){for(var e=[],t=this.children,n=0;n<t.length;n++)e.push(t[n].getRendererBody());return e.join("")},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,n=this.children.length;n>t;t++)e.addChild(this.children[t].clone());for(var t=0,n=this.cloneProps.length;n>t;t++){var r=this.cloneProps[t];e[r]=this[r]}return e}};var O='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';i(h,p),i(g,p),i(v,p),i(y,p),i(b,p),i(w,p),i(E,p),i(k,p),i(x,k),i(C,k);var P={READING:1,READED:2,APPLIED:3,READY:4};v.prototype.applyMaster=h.prototype.applyMaster=function(e){function t(e){var r=e.children;if(r instanceof Array)for(var i=0,o=r.length;o>i;i++){var a=r[i];if(a instanceof g&&n[a.name])a=r[i]=n[a.name];t(a)}}if(this.state>=P.APPLIED)return 1;var n=this.blocks,r=this.engine.targets[e];if(r&&r.applyMaster(r.master))return this.children=r.clone().children,t(this),this.state=P.APPLIED,1;else return void 0},h.prototype.isReady=function(){function e(r){for(var i=0,o=r.children.length;o>i;i++){var a=r.children[i];if(a instanceof v){var s=t.targets[a.name];n=n&&s&&s.isReady(t)}else if(a instanceof p)e(a)}}if(this.state>=P.READY)return 1;var t=this.engine,n=1;if(this.applyMaster(this.master))return e(this),n&&(this.state=P.READY),n;else return void 0},h.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[O,S,this.getRendererBody(),M].join("\n")),t=this.engine;return this.renderer=function(n){return e(n,t)},this.renderer}return null},h.prototype.open=function(e){m(e),p.prototype.open.call(this,e),this.state=P.READING,T(this,e)},y.prototype.open=w.prototype.open=function(e){e.stack.top().addChild(this)},g.prototype.open=function(e){p.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this},x.prototype.open=function(e){var t=new C;t.open(e);var n=m(e,k);n.addChild(this),e.stack.push(this)},C.prototype.open=function(e){var t=m(e,k);t.addChild(this),e.stack.push(this)},v.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,p.prototype.open.call(this,e),this.state=P.READING,e.imp=this},w.prototype.close=y.prototype.close=function(){},v.prototype.close=function(e){p.prototype.close.call(this,e),this.state=P.READED,e.imp=null},h.prototype.close=function(e){p.prototype.close.call(this,e),this.state=this.master?P.READED:P.APPLIED,e.target=null},v.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var n in this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(e)},w.prototype.beforeOpen=v.prototype.beforeOpen=y.prototype.beforeOpen=E.prototype.beforeOpen=b.prototype.beforeOpen=g.prototype.beforeOpen=k.prototype.beforeOpen=d.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new h(r(),e.engine);t.open(e)}},v.prototype.getRendererBody=function(){return this.applyMaster(this.name),p.prototype.getRendererBody.call(this)},w.prototype.getRendererBody=function(){return l("{0}engine.render({2},{{3}}){1}",B,L,a(this.name),f(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,n){return(t||"")+a(n)+":"}))},y.prototype.getRendererBody=function(){if(this.expr)return l("v[{0}]={1};",a(this.name),f(this.expr,this.engine));else return""},k.prototype.getRendererBody=function(){return l("if({0}){{1}}",f(this.value,this.engine),p.prototype.getRendererBody.call(this))},C.prototype.getRendererBody=function(){return l("}else{{0}",p.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){return l('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',r(),f(this.list,this.engine),a(this.index||r()),a(this.item),r(),r(),p.prototype.getRendererBody.call(this))},b.prototype.getRendererBody=function(){var e=this.args;return l("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",S,M,B,L,p.prototype.getRendererBody.call(this),a(this.name),e?","+f(e,this.engine):"")};var q={};$("target",h),$("block",g),$("import",v),$("use",w),$("var",y),$("for",E),$("if",k),$("elif",x),$("else",C),$("filter",b),N.prototype.config=function(e){t(this.options,e)},N.prototype.compile=N.prototype.parse=function(e){if(e){var t=D(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},N.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},N.prototype.render=function(e,t){var n=this.getRenderer(e);if(n)return n(t);else return""},N.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var H=new N;if(H.Engine=N,"object"==typeof exports&&"object"==typeof module)exports=module.exports=H;else if("function"==typeof define&&define.amd)define("etpl/main",[],H);else e.etpl=H}(this),define("etpl",["etpl/main"],function(e){return e}),define("eform-dom/util/cache",["require","eform-lang/guid"],function(require){function e(e){var t;if(null==e||"object"!=typeof e&&"function"!=typeof e||(t=e.nodeType)&&1!==t&&9!==t)return-1;else return 1===t&&e.uniqueID||e[s]||(e[s]=o())}function t(t,n){var r;if(!((r=e(t))<0)){var i,o=l[r]=l[r]||{},s=a[n]||{};if("get"in s&&void 0!==(i=s.get(t,o[n],o)))return i;else return o[n]}}function n(t,n,r){var i;if(!((i=e(t))<0)){var o=l[i]=l[i]||{},s=a[n]||{};if(!("set"in s&&void 0===(r=s.set(t,r,o[n],o))))o[n]=r}}function r(t,n){var r,i;if(!((r=e(t))<0)&&(i=l[r])){var o=a[n]||{};if(!("remove"in o&&void 0!==o.remove(t,i[n],i)))delete i[n]}}function i(t,n){var r;if(!((r=e(t))<0)){if(n)for(var o=t.getElementsByTagName("*"),s=0,u=o.length;u>s;s++)1===o[s].nodeType&&i(o[s]);var c=l[r];if(c){for(var f in c)if(c.hasOwnProperty(f)){var d=a[f]||{};"remove"in d&&d.remove(t,c[f],c)}delete l[r]}}}var o=require("eform-lang/guid"),a={},s="eform-cache"+(new Date).getTime(),l={};return{expando:s,hooks:a,getData:t,setData:n,removeData:r,cleanData:i}}),define("eform-dom/util/contains",[],function(){var e,t=document.documentElement;if(t.contains||t.compareDocumentPosition)e=function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;if(e===r)return!0;if(n.contains)return!(!r||1!==r.nodeType||!n.contains(r));else return!!(r&&1===r.nodeType&&e.compareDocumentPosition&&16&e.compareDocumentPosition(r))};else e=function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};return e}),define("eform-dom/util/nodeName",[],function(){function e(e,t){return!(!e.nodeName||e.nodeName.toLowerCase()!==t.toLowerCase())}return e}),define("eform-dom/event/special",["require","eform-lang/each","../util/contains","../util/nodeName"],function(require){function e(){try{return document.activeElement}catch(e){}}var t=require("eform-lang/each"),n=require("../util/contains"),r=require("../util/nodeName"),i={load:{noBubble:!0},focus:{delegateType:"focusin",trigger:function(){if(this!==e()&&this.focus)try{return this.focus(),!1}catch(t){}}},blur:{delegateType:"focusout",trigger:function(){if(this!==e()&&this.blur)return this.blur(),!1;else return void 0}},click:{trigger:function(){if(r(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1;else return void 0},_default:function(e){return r(e.target,"a")}},beforeunload:{postDispatch:function(e){if(void 0!==e.result&&e.originalEvent)e.originalEvent.returnValue=e.result}}};if(t({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){i[e]={delegateType:t,bindType:t,handle:function(e){var r,i=e.relatedTarget,o=this,a=e.handlerObj;if(!i||i!==o&&!n(o,i))e.type=a.origType,r=a.handler.apply(o,arguments),e.type=t;return r}}}),"onmousewheel"in document){var o="onwheel"in document?"wheel":"DOMMouseScroll";i.mousewheel={delegateType:o,bindType:o}}return i}),define("eform-dom/event/MiniHandlerObject",["require","./special"],function(require){function e(e){var t=r.exec(e),n=t[2]?t[2].split(".").sort():[];return n.type=t[1],n}function t(t,r,i,o,a){var s=e(t),l=this.origType=s.type,u=n[l]||{};this.type=(i?u.delegateType:u.bindType)||l,this.namespace=s.join("."),this.handler=r,this.one=!!a,this.selector=i,this.data=o}var n=require("./special"),r=/^([^.]*)(?:\.(.+)|)$/;return t.prototype={constructor:t,validate:function(e,t,n,r){return!(e&&e!==this.type||t&&t!==this.handler||n&&!n.test(this.namespace)||r&&r!==this.selector&&("**"!==r||!this.selector))},packNamespace:function(){return this.namespace?new RegExp("(^|\\.)"+this.namespace.replace(".","\\.(?:.*\\.|)")+"(\\.|$)"):null}},t}),define("eform-dom/selector/whitespace",[],function(){return"[\\x20\\t\\r\\n\\f]"}),define("eform-dom/util/camelCase",[],function(){function e(e){return e.replace(t,"ms-").replace(n,r)}var t=/^-ms-/,n=/-([\da-z])/gi,r=function(e,t){return t.toUpperCase()};return e}),define("eform-dom/attributes/support",[],function(){var e={},t=document.createElement("div");t.setAttribute("className","t"),t.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>';var n=t.getElementsByTagName("a")[0];n.style.cssText="top:1px";var r=document.createElement("select"),i=r.appendChild(document.createElement("option")),o=t.getElementsByTagName("input")[0];return e.getSetAttribute="t"!==t.className,e.style=/top/.test(n.getAttribute("style")),e.hrefNormalized="/a"===n.getAttribute("href"),e.checkOn=!!o.value,e.optSelected=i.selected,e.enctype=!!document.createElement("form").enctype,r.disabled=!0,e.optDisabled=!i.disabled,o=document.createElement("input"),o.setAttribute("value",""),e.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),e.radioValue="t"===o.value,e}),define("eform-dom/attributes/propFix",["require","eform-lang/each","./support"],function(require){var e=require("eform-lang/each"),t=require("./support"),n={"for":"htmlFor","class":"className"};if(e(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(e,t){n[t.toLowerCase()]=t}),!t.enctype)n.enctype="encoding";return n}),define("eform-dom/attr",["require","eform-lang/each","./util/camelCase","./util/nodeName","./attributes/support","./attributes/propFix"],function(require){function e(i,a,s){if(i&&1===i.nodeType){a=a.toLowerCase();var p,m=t[a]||(f.test(a)?n:r);if(null===s){var h=l[a]||a;if(f.test(a))if(c&&u||!d.test(a))i[h]=!1;else i[o("default-"+a)]=i[h]=!1;else e(i,a,"");return i.removeAttribute(u?a:h),null}if(void 0===s&&m&&"get"in m&&null!==(p=m.get(i,a)))return p;if(void 0===s)return p=i.getAttribute(a),null!=p?p:void 0;if(m&&"set"in m&&void 0!==(p=m.set(i,s,a)))return p;else return i.setAttribute(a,s+""),s}}var t,n,r,i=require("eform-lang/each"),o=require("./util/camelCase"),a=require("./util/nodeName"),s=require("./attributes/support"),l=require("./attributes/propFix"),u=s.getSetAttribute,c=s.input,f=/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,d=/^(?:checked|selected)$/i;if(t={type:{set:function(e,t){if(!s.radioValue&&"radio"===t&&a(e,"input")){var n=e.value;if(e.setAttribute("type",t),n)e.value=n;return t}}}},!c||!u)t.value={set:function(e,t,n){if(a(e,"input"))e.defaultValue=t;else return r&&r.set(e,t,n)},get:function(e,t){if(a(e,"input"))return e.defaultValue;else return r?r.get(e,t):null}};if(!s.style)t.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}};if(n={set:function(t,n,r){if(n===!1)e(t,r,null);else if(c&&u||!d.test(r))t.setAttribute(!u&&l[r]||r,r);else t[o("default-"+r)]=t[r]=!0;return r},get:function(e,t){var n;if(e[t]===!0||(n=e.getAttributeNode(t))&&n.specified)return t.toLowerCase();else return void 0}},!u)r={set:function(e,t,n){var r=e.getAttributeNode(n);if(!r)r=e.ownerDocument.createAttribute(n),e.setAttributeNode(r);if(r.value=t+="","value"===n||t===e.getAttribute(n))return t;else return void 0},get:function(e,t){var n;if((n=e.getAttributeNode(t))&&n.specified)return n.value;else return void 0}},t.contenteditable={set:function(e,t,n){r.set(e,""===t?!1:t,n)}},i(["width","height"],function(e,n){t[n]={set:function(e,t){if(""===t)return e.setAttribute(n,"auto"),t;else return void 0},get:function(e,t){return e.getAttribute(t,2)}}}),i(["type","href"],function(e,n){t[n]={get:function(t,n){return t.getAttribute(n,e+1)}}}),i(["id","name","coords"],function(e,n){t[n]={get:function(e,t){var n;if((n=e.getAttributeNode(t))&&""!==n.value)return n.value;else return void 0}}});return e}),define("eform-dom/selector/support",[],function(){var e=/^[^{]+\{\s*\[native \w/,t={};t.getByClass=e.test(document.getElementsByClassName);var n=document.createElement("div"),r="selector-"+(new Date).getTime();if(document.body.appendChild(n).id=r,t.getById=!document.getElementsByName(r).length,t.qsa=e.test(document.querySelectorAll))n.innerHTML='<select><option selected=""></option></select>',t.qsaAttribute=n.querySelectorAll("[selected]").length;return document.body.removeChild(n),n=null,t}),define("eform-dom/selector/unescape",["require","./whitespace"],function(require){function e(e){return e.replace(n,r)}var t=require("./whitespace"),n=new RegExp("\\\\([\\da-f]{1,6}"+t+"?|("+t+")|.)","ig"),r=function(e,t,n){var r="0x"+t-65536;if(isNaN(r)||n)return t;if(0>r)return String.fromCharCode(r+65536);else return String.fromCharCode(r>>10|55296,1023&r|56320)};return e}),define("eform-dom/selector/identifier",[],function(){return"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+"}),define("eform-dom/selector/tokenize",["require","./whitespace","./identifier","./unescape"],function(require){function e(e){for(var t,n,r,u=[];e;){if(!n||(r=i.exec(e))){if(r)e=e.slice(r[0].length)||e;u.push(t=[])}if(n=!1,r=o.exec(e))n=r.shift(),t.push({matched:n,type:r[0].replace(a," ")}),e=e.slice(n.length);for(var c in s)if(s.hasOwnProperty(c)&&(r=s[c].exec(e))){if(n=r.shift(),l[c])if(r=r=l[c](r),!r)throw new Error(n+"解析失败");t.push({matched:n,value:r,type:c}),e=e.slice(n.length)}if(!n)break}if(e)throw new Error(e+"解析失败");return u.slice(0)}var t=require("./whitespace"),n=require("./identifier"),r=require("./unescape"),i=new RegExp("^"+t+"*,"+t+"*"),o=new RegExp("^"+t+"*([>+~]|"+t+")"+t+"*"),a=new RegExp("^"+t+"+|((?:^|[^\\\\])(?:\\\\.)*)"+t+"+$","g"),s={ID:new RegExp("^#("+n+")"),CLASS:new RegExp("^\\.("+n+")"),TAG:new RegExp("^("+n+"|[*])"),ATTR:new RegExp("^\\["+t+"*("+n+")(?:"+t+"*([*^$|!~]?=)"+t+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+n+"))|)"+t+"*\\]"),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+t+"*(even|odd|(([+-]|)(\\d*)n|)"+t+"*(?:([+-]|)"+t+"*(\\d+)|))"+t+"*\\)|)","i"),PSEUDO:new RegExp("^:(empty|focus|target|enabled|disabled|checked|root|lang|not)(?:\\("+t+"*(.+)"+t+"*\\)|)","i")},l={ATTR:function(e){return e[0]=r(e[0]),e[2]=r(e[2]||e[3]||e[4]||""),e.slice(0,3)},CHILD:function(e){if(e[0]=e[0].toLowerCase(),"nth"===e[0].slice(0,3))if(!e[2])return null;else return e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2]),e;else if(e[2])return null;return e},PSEUDO:function(e){if(e[0]=e[0].toLowerCase(),"lang"!==e[0]&&"not"!==e[0])return e[1]?null:e.slice(0,1);else return!e[1]?null:e.slice(0,2)}};return e}),define("eform-dom/selector/compile",["require","../attr","./support","./unescape","./tokenize","./whitespace"],function(require){function e(e,t){var n=t.dir,r=!e&&"parentNode"===n;if(e=e||function(e,t){return e===t},t.first)return function(t,i){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i)};else return function(t,i){for(;t=t[n];)if(1===t.nodeType||r)if(e(t,i))return!0}}function t(e){if(e.length>1)return function(t,n){for(var r=e.length;r--;)if(!e[r](t,n))return!1;return!0};else return e[0]}function n(e){if(1===e.length)return e[0];else return function(t,n){for(var r=0,i=e.length;i>r;r++)if(e[r](t,n))return!0;return!1}}function r(n){for(var r=d[n[0].type],i=r||d[" "],o=e(null,i),a=[function(e,t){return!r&&!t||o(e,t)}],s=r?1:0,l=n.length;l>s;s++){var u,c=n[s];if(u=d[c.type])a=[e(t(a),u)];else a.push(f[n[s].type].apply(null,n[s].value))}return t(a)}function i(e,t){t=t||l(e);for(var i=[],o=0,a=t.length;a>o;o++)i.push(r(t[o]));return n(i)}var o=require("../attr"),a=require("./support"),s=require("./unescape"),l=require("./tokenize"),u=require("./whitespace"),c={lang:function(e){return e=s(e).toLowerCase(),function(t){var n;do if(n=t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}},target:function(){return function(e){var t=window.location&&window.location.hash;return t&&t.slice(1)===e.id}},root:function(){return function(e){return e===document.documentElement
}},focus:function(){return function(e){return e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(e.type||e.href||~e.tabIndex)}},enabled:function(){return function(e){return e.disabled===!1}},disabled:function(){return function(e){return e.disabled===!0}},checked:function(){return function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected}},empty:function(){return function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0}}},f={ATTR:function(e,t,n){if("~="===t)var r=new RegExp(u+n+u);return function(i){var a=o(i,e);if(null==a)return"!="===t;if(!t)return!0;switch(a+="",t){case"=":return a===n;case"!=":return a!==n;case"^=":return n&&0===a.indexOf(n);case"*=":return n&&a.indexOf(n)>-1;case"$=":return n&&a.slice(-n.length)===n;case"~=":return r.test(" "+a+" ");case"|=":return a===n||a.slice(0,n.length+1)===n+"-";default:return!1}}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;if(1===r&&0===i)return function(e){return!!e.parentNode};else return function(t){var n=t.parentNode;if(!n)return!1;var l,u=s&&t.nodeName.toLowerCase(),c=o!==a?"nextSibling":"previousSibling";if(o){for(var f=!1;c;){for(l=t;l=l[c];)if(s?l.nodeName.toLowerCase()===u:1===l.nodeType)return!1;f=c="only"===e&&!f&&"nextSibling"}return!0}var d=0;for(l=a?n.firstChild:n.lastChild;l&&((s?l.nodeName.toLowerCase()!==u:1!==l.nodeType)||!++d||l!==t);l=l[c]);return d-=i,d===r||d%r===0&&d/r>=0}},CLASS:function(e){var t=new RegExp("(^|"+u+")"+e+"("+u+"|$)");return function(e){return t.test("string"==typeof e.className&&e.className||"")}},ID:a.getById?function(e){var t=s(e);return function(e){return e.getAttribute("id")===t}}:function(e){var t=s(e);return function(e){var n;return(n=e.getAttributeNode("id"))&&n.value===t}},PSEUDO:function(e,t){return c[e](t)},TAG:function(e){var t=s(e).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}}};c.not=function(e){var t=l(e);if(1!==t.length||1!==t[0].length)throw new Error(e+"不是一个合法的:not选择器");var n=t[0][0],r=f[n.type].apply(null,n.value);return function(e,t){return!r(e,t)}};var d={">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}};return i}),define("eform-dom/matches",["require","./selector/whitespace","./selector/compile"],function(require){function e(e,t,o){if(!e||!e.nodeType||1!==e.nodeType||!t)return!1;if(t=t.replace(i,"$1").replace(r,"='$1']"),!o&&a)try{var s=a.call(e,t);if(s||l||e.document&&11!==e.document.nodeType)return s}catch(u){}var c=n(t);return c(e,o)}var t=require("./selector/whitespace"),n=require("./selector/compile"),r=new RegExp("="+t+"*([^\\]'\"]*?)"+t+"*\\]","g"),i=new RegExp("^"+t+"+|((?:^|[^\\\\])(?:\\\\.)*)"+t+"+$","g"),o=document.documentElement,a=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector;if(a){var s=document.createElement("div"),l=a.call(s,"div");s=null}return e}),define("eform-dom/event/MiniHandlerQueue",["require","../matches"],function(require){function e(e){this.element=e,this.delegateCount=0,this.handlers=[]}var t=require("../matches");return e.prototype={constructor:e,add:function(e){var t=this.handlers;if(e.selector)t.splice(this.delegateCount++,0,e);else t.push(e)},remove:function(e,t,n,r){for(var i=this.handlers,o=i.length;o--;){var a=i[o];if(a.validate(e,t,n,r))if(i.splice(o,1),a.selector)this.delegateCount--}return this.isEmpty()},isEmpty:function(){return!this.handlers.length},getHandlerQueue:function(t){var n=this.element,r=this.handlers,i=[],o=t.target,a=this.delegateCount;if(a&&o.nodeType&&(!t.button||"click"!==t.type))for(;o!==n;o=o.parentNode||n)if(1===o.nodeType&&(o.disabled!==!0||"click"!==t.type)){for(var s=[],l=0;a>l;l++){var u=r[l],c=u.selector+" ";if(void 0===s[c])s[c]=e.matches(o,c,n);if(s[c])s.push(u)}if(s.length)i.push({elem:o,handlers:s})}if(a<r.length)i.push({elem:n,handlers:r.slice(a)});return i}},e.matches=t,e}),define("eform-dom/event/MiniEvent",[],function(){function e(){return!1}function t(){return!0}function n(e,n){if(e&&e.type){if(this.originEvent=e,this.type=e.type,e.defaultPrevent||void 0===e.defaultPrevented&&e.returnValue===!1)this.isDefaultPrevented=t}else this.type=e;for(var r in n)if(n.hasOwnProperty(r))this[r]=n[r];this.timeStemp=e&&e.timeStemp||(new Date).getTime(),this.isMiniEvent=!0}return n.prototype={constructor:n,isDefaultPrevented:e,isPropagationStopped:e,isImmediatePropagationStopped:e,preventDefault:function(){var e=this.originEvent;if(this.isDefaultPrevented=t,e)if(e.preventDefault)e.preventDefault();else e.returnValue=!1},stopPropagation:function(){var e=this.originEvent;if(this.isPropagationStopped=t,e)if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0},stopImmediatePropagation:function(){var e=this.originEvent;if(this.isImmediatePropagationStopped=t,e&&e.stopImmediatePropagation)e.stopImmediatePropagation();this.stopPropagation()}},n}),define("eform-dom/event/fix",["require","./MiniEvent"],function(require){function e(e){if(e.isMiniEvent)return e;var c=e.type,f=a[c],d=new t(e);if(!f){if(n.test(c))f=s;else if(r.test(c))f=l;else if(i.test(c))f=u;else f={};a[c]=f}for(var p=f.props?o.concat(f.props):o,m=p.length;m--;){var h=p[m];d[h]=e[h]}if(!d.target)d.target=e.srcElement||document;if(3===d.target.nodeType)d.target=e.target.parent;return f.filter?f.filter(d,e):d}var t=require("./MiniEvent"),n=/^key/,r=/^(?:mouse|pointer|contextmenu)|click|wheel/i,i=/^touch/,o="altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),a={},s={props:"char charCode key keyCode".split(" "),filter:function(e,t){if(!e.which)e.which=null!=t.keyCode?t.keyCode:t.charCode;return e}},l={props:"button buttons clientX clientY pageX pageY fromElement offsetX offsetY screenX screenY toElement".split(" "),filter:function(e,t){var n=t.button;if(null==e.pageX&&null!=e.clientX){var r=e.target.ownerDocument||document,i=r.documentElement,o=r.body;e.pageX=t.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)}if(!e.which&&void 0!==n)switch(n){case 1:e.which=1;break;case 2:e.which=3;break;case 4:e.which=2;break;default:e.which=0}return e.wheelDelta=t.wheelDelta||((t.deltaY||t.detail)>0?-120:120),e}},u={props:l.props.concat("touches changedTouches".split(" "))};return e}),define("eform-dom/event/MiniHandler",["require","eform-lang/each","./MiniHandlerObject","./MiniHandlerQueue","./special","./fix"],function(require){function e(t){var n=this;this.events={},this.handle=function(t){if(!t||e.triggered!==t.type)n.dispatch(t,a.call(arguments))},this.handle.elem=this.element=t}var t=require("eform-lang/each"),n=require("./MiniHandlerObject"),r=require("./MiniHandlerQueue"),i=require("./special"),o=require("./fix"),a=[].slice;return e.prototype={constructor:e,add:function(t,o,a,s,l){var u=new n(t,o,a,s,l),c=u.type,f=i[c]||{},d=this.events[c];if(!d)if(d=this.events[c]=new r(this.element),!f.setup||f.setup.call(this.element,s,u.namespace,this.handle)===!1)e.addEvent(this.element,c,this.handle);d.add(u)},remove:function(e,r,i){var o=this,a=new n(e,null,i),s=a.type;if(!s)return t(this.events,function(e){o.remove(e+"."+a.namespace,r,i)}),!0;var l=this.events[s];if(l&&l.remove(a.origType,r,a.packNamespace(),i))this.removeEventHandlers(s);return!0},dispatch:function(e,t){var n,r=this.element,a=t[0]=o(e);if(n=this.events[a.type]){var s=i[a.type]||{};a.delegateTarget=r;for(var l,u=0,c=n.getHandlerQueue(a);(l=c[u++])&&!a.isPropagationStopped();){a.currentTarget=l.elem;for(var f,d=0;(f=l.handlers[d++])&&!a.isImmediatePropagationStopped();)if(!a.rnamespace||a.rnamespace.test(f.namespace)){if(a.handlerObj=f,a.data=f.data,f.one)n.splice(n.indexOf(f),1);var p=(i[f.origType]||{}).handle||f.handler,m=p.apply(l.elem,t);if(void 0!==m)if(a.result=m,m===!1)a.preventDefault(),a.stopPropagation()}}if(n.isEmpty())this.removeEventHandlers(a.type);return s.postDispatch&&s.postDispatch.call(r,a),a.result}},removeEventHandlers:function(t){var n=i[t]||{};if(!n.teardown||n.teardown.call(this.element,this.handle)===!1)e.removeEvent(this.element,t,this.handle);delete this.events[t]},dispose:function(){var e=this;t(this.events,function(t){e.removeEventHandlers(t)}),this.element=null,this.handle=null,this.events=null}},e.triggered=null,e.addEvent=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else e.attachEvent("on"+t,n)},e.removeEvent=function(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else{var r="on"+t;if(void 0===e[r])e[r]=null;e.detachEvent(r,n)}},e}),define("eform-dom/bind",["require","eform-lang/each","./util/cache","./event/MiniHandler"],function(require){function e(e,r,i,o,a,s){var l=n.getData(e,"events");if(l&&r){var u=r.match(/\S+/g)||[];t(u,function(e,t){l.add(t,i,a,o,s)})}}var t=require("eform-lang/each"),n=require("./util/cache"),r=require("./event/MiniHandler");return n.hooks.events={get:function(e,t,n){if(!t)return n.events=new r(e);else return void 0},remove:function(e,t){t.dispose()}},e}),define("eform-lang/merge",[],function(){function e(e,t){e=e||[];var n=1;if(arguments.length===n)return e;for(var r=e.length;n<arguments.length;n++)if(t=arguments[n],null!=t){for(var i=+t.length,o=0;i>o;)e[r++]=t[o++];if(isNaN(i))for(;void 0!==t[o];)e[r++]=t[o++]}return e.length=r,e}return e}),define("eform-dom/manipulation/getAll",["require","eform-lang/merge","../util/nodeName"],function(require){function e(r,i){var o;if("undefined"!=typeof r.getElementsByTagName)o=r.getElementsByTagName(i||"*");else if("undefined"!=typeof r.querySelectorAll)o=r.querySelectorAll(i||"*");else{o=[];for(var a,s=r.childNodes||r,l=0;null!=(a=s[l]);l++)t(o,e(a,i))}if(void 0===i||i&&n(r,i))return t([r],o);else return o}var t=require("eform-lang/merge"),n=require("../util/nodeName");return e}),define("eform-dom/manipulation/support",[],function(){var e={},t=document.createElement("input"),n=document.createElement("div"),r=document.createDocumentFragment();if(n.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',e.leadingWhitespace=3===n.firstChild.nodeType,e.tbody=!n.getElementsByTagName("tbody").length,e.htmlSerialize=!!n.getElementsByTagName("link").length,e.html5Clone="<:nav></:nav>"!==document.createElement("nav").cloneNode(!0).outerHTML,t.type="checkbox",t.checked=!0,r.appendChild(t),e.appendChecked=t.checked,n.innerHTML="<textarea>x</textarea>",e.noCloneChecked=!!n.cloneNode(!0).lastChild.defaultValue,r.appendChild(n),n.innerHTML='<input type="radio" checked="checked" name="t"/>',e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.noCloneEvent=!0,n.attachEvent)n.attachEvent("onclick",function(){e.noCloneEvent=!1}),n.cloneNode(!0).click();return e}),define("eform-dom/manipulation/nodeNames",[],function(){return"abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video"}),define("eform-dom/manipulation/createSafeFragment",["require","./nodeNames"],function(require){function e(){var e=document.createDocumentFragment();if(e.createElement)for(;t.length;)e.createElement(t.pop());return e}var t=require("./nodeNames").split("|");return e}),define("eform-dom/parse",["require","eform-lang/merge","./util/nodeName","./manipulation/getAll","./manipulation/support","./manipulation/createSafeFragment"],function(require){function e(e,d){if(!e||"string"!=typeof e)return null;d=d||document;var p=[],m=o(d),h=m.appendChild(d.createElement("div")),g=(l.exec(e)||["",""])[1].toLowerCase(),v=f[g]||f._default,y=v[0];for(h.innerHTML=v[1]+e.replace(s,"<$1></$2>")+v[2];y--;)h=h.lastChild;if(!i.leadingWhitespace&&a.test(e))p.push(d.createTextNode(a.exec(e)[0]));if(!i.tbody){var b=!1;if("table"===g&&!u.test(e))b=h.firstChild;else if("<table>"===v[1]&&!u.test(e))b=h;for(y=b&&b.childNodes.length;y--;){var w=b.childNodes[y];if(n(w,"tbody")&&!w.childNodes.length)b.removeChild(w)}}for(p=t(p,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);if(m.removeChild(m.lastChild),!i.appendChecked)for(var E=r(p,"input"),k=0,x=E.length;x>k;k++){var C=E[k];if(c.test(C.type))C.defaultChecked=C.checked}for(var T=0,$=p.length;$>T;T++)m.appendChild(p[T]);return m}var t=require("eform-lang/merge"),n=require("./util/nodeName"),r=require("./manipulation/getAll"),i=require("./manipulation/support"),o=require("./manipulation/createSafeFragment"),a=/^\s+/,s=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,l=/<([\w:]+)/,u=/<tbody/i,c=/^(?:checkbox|radio)$/i,f={option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:i.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};return e}),define("eform-lang/trim",[],function(){function e(e){return null==e?"":(e+"").replace(t,"")}var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return e}),define("eform-dom/class",["require","eform-lang/trim"],function(require){function e(e,t){var n=t&&t.match(o);if(n){var a=e&&1===e.nodeType&&(e.className?(" "+e.className+" ").replace(i," "):" ");if(a){for(var s=0,l=n.length;l>s;s++){var u=n[s];if(a.indexOf(" "+u+" ")<0)a+=u+" "}var c=r(a);if(e.className!==c)e.className=c}}}function t(e,t){var n=t&&t.match(o);if(n){var a=e&&1===e.nodeType&&(e.className?(" "+e.className+" ").replace(i," "):" ");if(a){for(var s=0,l=n.length;l>s;s++){var u=n[s];if(a.indexOf(" "+u+" ")>=0)a=a.replace(" "+u+" "," ")}var c=t?r(a):"";if(e.className!==c)e.className=c}}}function n(e,t){return!!(1===e.nodeType&&(" "+e.className+" ").replace(i," ").indexOf(" "+t+" ")>=0)}var r=require("eform-lang/trim"),i=/[\t\r\n\f]/g,o=/\S+/g;return{addClass:e,removeClass:t,hasClass:n}}),define("category/category.tpl",[],function(){return'<!-- target: category -->\n<h3 class="<!-- if: !${currentFirst}-->active<!--/if-->">所有任务(<span id="category-count">${count}</span>)</h3>\n<h4>全部分类</h4>\n<!-- for: ${categories} as ${group}-->\n<dl data-id="${group.id}" class="<!-- if: ${currentFirst} === ${group.id}-->active<!--/if-->">\n    <dt data-id="${group.id}"  class="<!-- if: ${currentFirst} === ${group.id}  && !${currentSecond} -->active<!--/if-->">\n        <i class="iconfont icon-iconfontwenjianjiadakai"></i>\n        <span>${group.title}(<span>${group.count}</span>)</span>\n        <!-- if: !${group.readonly} -->\n        <a class="btn">删除<i class="iconfont icon-chahao"></i></a>\n        <!--/if-->\n    </dt>\n    <!-- for: ${group.children} as ${item} -->\n    <dd data-id="${item.id}" class="<!-- if: ${currentSecond} === ${item.id} -->active<!--/if-->">\n        <i class="iconfont icon-11"></i>\n        <span>${item.title}(<span>${item.count}</span>)</span>\n        <!-- if: !${item.readonly} -->\n        <a class="btn" href=javascript:void(0)>删除<i class="iconfont icon-chahao"></i></a>\n        <!--/if-->\n    </dd>\n    <!-- /for -->\n</dl>\n<!-- /for -->\n'}),define("dialog/category",["require","eform-dom/bind","eform-dom/class"],function(require){var e=require("eform-dom/bind"),t=require("eform-dom/class"),n=document.getElementById("category-note"),r=document.getElementById("dialog-category"),i=document.getElementById("mask"),o=document.getElementById("category-title"),a=document.getElementById("category-error"),s=null,l={show:function(e,l){s=l,t.removeClass(i,"hidden"),o.value=e||"",n.innerHTML=e?"重命名分类":"新增分类",a.innerHTML="",t.removeClass(r,"hidden");try{o.focus()}catch(u){}},hide:function(){t.addClass(r,"hidden"),t.addClass(i,"hidden")}};return e(r,"click",function(e){e.preventDefault(),l.hide()},null,"[data-role=close]"),e(r,"click",function(e){e.preventDefault();var t=o.value;if(!t)return void(a.innerHTML="分类标题必须填写");if(t.length>10)return void(a.innerHTML="分类标题不能超过10个字符");else return l.hide(),void(s&&s(o.value))},null,"[data-role=confirm]"),e(r,"submit",function(e){e.preventDefault(),l.hide(),s&&s(o.value)},null,"form"),l}),define("dialog/confirm",["require","eform-dom/bind","eform-dom/parse","eform-dom/class"],function(require){var e=require("eform-dom/bind"),t=(require("eform-dom/parse"),require("eform-dom/class")),n=document.getElementById("confirm-title"),r=document.getElementById("confirm"),i=document.getElementById("mask"),o=null,a={show:function(e,a){o=a,t.removeClass(i,"hidden"),n.innerHTML=e||"请确认",t.removeClass(r,"hidden")},hide:function(){t.addClass(r,"hidden"),t.addClass(i,"hidden")}};return e(r,"click",function(e){e.preventDefault(),a.hide()},null,"[data-role=close]"),e(r,"click",function(e){e.preventDefault(),a.hide(),o&&o()},null,"[data-role=confirm]"),a}),define("category/view",["require","eform-emitter","etpl","eform-dom/bind","eform-dom/parse","eform-dom/class","./category.tpl","../dialog/category","../dialog/confirm"],function(require){var e=require("eform-emitter"),t=require("etpl"),n=require("eform-dom/bind"),r=(require("eform-dom/parse"),require("eform-dom/class")),i=require("./category.tpl");t.compile(i);var o={};e.mixin(o);var a=document.getElementById("category-items");o.draw=function(e){a.innerHTML=t.render("category",e)};var s=require("../dialog/category");n(document.getElementById("category-add"),"click",function(){s.show("",function(e){o.emit("add",e)})}),n(a,"click",function(){if(!r.hasClass(this,"active"))o.emit("change",this.getAttribute("data-id"))},null,"dt"),n(a,"click",function(){if(!r.hasClass(this,"active"))o.emit("change",this.getAttribute("data-id"))},null,"dd"),n(a,"click",function(){if(!r.hasClass(this,"active"))o.emit("change",this.getAttribute("data-id"))},null,"h3");var l=require("../dialog/confirm");return n(a,"click",function(e){e.stopPropagation();var t=this;l.show("删除不可恢复，确定要删除吗？",function(){o.emit("remove",t.parentNode.getAttribute("data-id"))})},null,".btn"),o}),define("category/controller",["require","eform-emitter","./model","./view"],function(require){var e=require("eform-emitter"),t=require("./model"),n=require("./view"),r={};return e.mixin(r),r.init=function(){var e=t.getCategories();n.draw(e),r.emit("change",t.getCurrentCategory())},n.on("add",function(e){t.addCategory(e);var r=t.getCategories();n.draw(r)}),n.on("change",function(e){if(t.setCurrentCategory(e))r.emit("change",t.getCurrentCategory());var i=t.getCategories();n.draw(i)}),n.on("remove",function(e){if(t.removeCategory(e))r.emit("change",t.getCurrentCategory());var i=t.getCategories();n.draw(i)}),t.on("change",function(){var e=t.getCategories();n.draw(e)}),r}),define("detail/model",["require","eform-lang/extend","../data/task","eform-emitter"],function(require){var e={},t=require("eform-lang/extend"),n=require("../data/task"),r=require("eform-emitter");return r.mixin(e),e.setTask=function(t){if(!t){e.isedit=!0;var r=new Date,i=r.getFullYear(),o=r.getMonth()+1,a=r.getDate();return e.task={id:"",title:"",date:("0000"+i).slice(-4)+"-"+("00"+o).slice(-2)+"-"+("00"+a).slice(-2),content:""}}return e.task=n.item(t)},e.setEdit=function(t){e.isedit=t},e.deleteTask=function(){n.remove(e.task.id),e.task=null},e.finishTask=function(){e.task.finished=!0,n.update(e.task.id,e.task)},e.setCategory=function(t){e.category=t},e.updateTask=function(r){var i=t(e.task,r);if(i.id)e.task=n.update(i.id,i);else e.task=n.insert(i.title,i.date,i.content,e.category);e.isedit=!1},e.getTask=function(){return e.task},e}),define("detail/detail.tpl",[],function(){return'<!-- target: task -->\n<h1>\n    <!-- if: ${isedit} -->\n    <input placeholder="请输入任务名称" value="${title}" id="form-title">\n    <span class="form-error" id="form-title-error"></span>\n    <!-- else -->\n    ${title}\n    <!-- /if-->\n    <!-- if: !${isedit} -->\n    <a class="btn" data-role="delete">删除<i class="iconfont icon-chahao"></i></a>\n    <!-- /if-->\n    <!-- if: !${isedit} && !${finished} -->\n    <a class="btn" data-role="edit">编辑<i class="iconfont icon-bianji"></i></a>\n    <a class="btn" data-role="finish">完成<i class="iconfont icon-wancheng"></i></a>\n    <!-- /if-->\n</h1>\n<h2 class="b-shadow">\n    <!-- if: ${isedit} -->\n    <input placeholder="请输入任务日期" value="${date}" id="form-date">\n    <span class="form-error" id="form-date-error"></span>\n    <!-- else -->\n    任务日期：${date}\n    <!-- /if-->\n</h2>\n<!-- if: ${isedit} -->\n<textarea placeholder="请输入任务详情" id="form-content"></textarea>\n<br/>\n<span class="form-error" id="form-content-error"></span>\n<!-- else -->\n<section>\n    <!-- for: ${list} as ${item} -->\n    <p>${item}</p>\n    <!-- /for -->\n</section>\n<!-- /if-->\n<!-- if: ${isedit} -->\n<div>\n    <input class="button" type="button" value="确定" data-role="confirm">\n    <!-- if: ${id} -->\n    <input class="button" type="button" value="取消" data-role="cancel">\n    <!-- /if-->\n</div>\n<!-- /if-->\n'}),define("detail/view",["require","eform-emitter","etpl","./detail.tpl","eform-dom/bind","../dialog/confirm"],function(require){var e=require("eform-emitter"),t=require("etpl"),n=require("./detail.tpl");t.compile(n);var r=require("eform-dom/bind"),i=document.getElementById("detail"),o={};e.mixin(o),o.draw=function(e,n){if(!e)return void(i.innerHTML="");else return void(i.innerHTML=t.render("task",{isedit:n,title:e.title||"",finished:e.finished||!1,date:e.date||"",list:e.content&&e.content.split(/\r?\n/)||[]}))},r(i,"click",function(e){e.preventDefault(),o.emit("edit")},null,"[data-role=edit]");var a=require("../dialog/confirm");return o.editConfirm=function(e){a.show("当前正在编辑任务，是否放弃？",e)},r(i,"click",function(e){e.preventDefault(),a.show("完成的任务无法再次编辑，是否确认",function(){o.emit("finish")})},null,"[data-role=finish]"),r(i,"click",function(e){e.preventDefault(),a.show("删除的任务无法恢复，是否确认删除",function(){o.emit("delete")})},null,"[data-role=delete]"),r(i,"click",function(e){e.preventDefault();var t=document.getElementById("form-title").value||"",n=document.getElementById("form-date").value||"",r=document.getElementById("form-content").value||"",i=!0;if(!t||t.length>20)document.getElementById("form-title-error").innerHTML=t?"任务标题不能超过20字":"任务标题必需输入",i=!1;else document.getElementById("form-title-error").innerHTML="";if(!n)document.getElementById("form-date-error").innerHTML="任务日期必须输入！",i=!1;else if(!/^\d{4}-\d{2}-\d{2}$/.test(n))document.getElementById("form-date-error").innerHTML="任务日期的格式应当为yyyy-MM-dd！",i=!1;else document.getElementById("form-date-error").innerHTML="";if(!r)document.getElementById("form-content-error").innerHTML="任务内容必须输入！",i=!1;else if(r.length>1e3)document.getElementById("form-content-error").innerHTML="任务内容不能超过1000字！",i=!1;else document.getElementById("form-content-error").innerHTML="";if(i)a.show("是否保存任务",function(){var e=document.getElementById("form-title").value||"",t=document.getElementById("form-date").value||"",n=document.getElementById("form-content").value||"";o.emit("confirm",{title:e,date:t,content:n})})},null,"[data-role=confirm]"),r(i,"click",function(e){e.preventDefault(),a.show("是否放弃当前输入的内容",function(){o.emit("cancel")})},null,"[data-role=cancel]"),o}),define("detail/controller",["require","eform-emitter","./model","./view"],function(require){var e=require("eform-emitter"),t=require("./model"),n=require("./view"),r={};return e.mixin(r),r.init=function(e){if(t.isedit)n.editConfirm(function(){var r=t.setTask(e);n.draw(r,!1)});else{var r=t.setTask(e);n.draw(r,!1)}},r.add=function(e){if(t.isedit)n.editConfirm(function(){var r=t.setTask();n.draw(r,!0),t.setCategory(e)});else{t.setCategory(e);var r=t.setTask();n.draw(r,!0)}},n.on("edit",function(){t.setEdit(!0);var e=t.getTask();n.draw(e,!0)}),n.on("cancel",function(){t.setEdit(!1),n.draw(task,!1)}),n.on("finish",function(){t.finishTask(),n.draw(t.getTask())}),n.on("delete",function(){t.deleteTask(),n.draw(t.getTask())}),n.on("confirm",function(e){t.updateTask(e),n.draw(t.getTask())}),r}),define("eform-lang/indexOf",[],function(){function e(e,t,n){var r;if(e){if(e.indexOf)return e.indexOf(t,n);for(r=e.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in e&&e[n]===t)return n}return-1}return e}),define("list/model",["require","eform-lang/each","eform-lang/indexOf","../data/task","eform-emitter"],function(require){var e=require("eform-lang/each"),t=(require("eform-lang/indexOf"),require("../data/task")),n={},r=require("eform-emitter");return r.mixin(n),n.setType=function(e){n.type=e},n.setCategory=function(e){n.category=e},n.getCategory=function(){return n.category||"category0"},n.setCurrentTask=function(e){n.currentTask=e},n.getCurrentTask=function(){return n.currentTask},n.getTasks=function(){var r=t.query(n.category,n.type,!0);if(r.length)if(!n.currentTask)n.currentTask=r[0].id;else{var i=!1;if(e(r,function(){if(this.id===n.currentTask)return i=!0,!1;else return void 0}),!i)n.currentTask=r[0].id}return{current:n.currentTask,list:r}},t.on("add",function(e){n.current=e.id,n.type="all",n.emit("change")}),t.on("remove",function(){n.emit("change",!0)}),t.on("update reload",function(){n.emit("change")}),n}),define("list/list.tpl",[],function(){return'<!-- target: list -->\n<!-- var: date = null -->\n<!-- for: ${list} as ${item} -->\n<!-- if: ${date} !== ${item.date} -->\n<dt>${item.date}</dt>\n<!-- var: date = ${item.date} -->\n<!-- /if-->\n<!-- if: ${item.id} === ${current} -->\n<dd data-id="${item.id}" class="active">${item.title}</dd>\n<!-- else -->\n<dd data-id="${item.id}">${item.title}</dd>\n<!-- /if-->\n<!-- /for -->\n'}),define("list/view",["require","eform-emitter","etpl","./list.tpl","eform-dom/bind","eform-dom/class"],function(require){var e=require("eform-emitter"),t=require("etpl"),n=require("./list.tpl");t.compile(n);var r=require("eform-dom/bind"),i=require("eform-dom/class"),o={};e.mixin(o);var a=document.getElementById("list-items");return o.draw=function(e){a.innerHTML=t.render("list",e)},r(a,"click",function(){if(!i.hasClass(this,"active")){for(var e=this.parentNode.firstChild;e;e=e.nextSibling)if("DD"===e.nodeName)if(e===this)i.addClass(e,"active");else i.removeClass(e,"active");o.emit("change",this.getAttribute("data-id"))}},null,"dd"),r(document.getElementById("list-type"),"click",function(){if(!i.hasClass(this,"active")){for(var e=this.parentNode.firstChild;e;e=e.nextSibling)if("SPAN"===e.nodeName)if(e===this)i.addClass(e,"active");else i.removeClass(e,"active");o.emit("type",this.getAttribute("data-role"))}},null,"span"),r(document.getElementById("list-add"),"click",function(){o.emit("add")}),o}),define("list/controller",["require","eform-emitter","./model","./view"],function(require){var e=require("eform-emitter"),t=require("./model"),n=require("./view"),r={};return e.mixin(r),r.init=function(e){t.setCategory(e);var i=t.getTasks();n.draw(i);var o=t.getCurrentTask();o&&r.emit("change",o)},n.on("add",function(){r.emit("add",t.getCategory())}),n.on("type",function(e){t.setType(e);var r=t.getTasks();n.draw(r)}),n.on("change",function(e){t.setCurrentTask(e),r.emit("change",e)}),t.on("change",function(e){var i=t.getTasks();if(n.draw(i),e){var o=t.getCurrentTask();o&&r.emit("change",o)}}),r}),define("index",["require","./category/controller","./detail/controller","./list/controller"],function(require){function e(){t.on("change",function(e){r.init(e)}),r.on("change",function(e){n.init(e)}),r.on("add",function(e){n.add(e)}),t.init()}var t=require("./category/controller"),n=require("./detail/controller"),r=require("./list/controller");return{init:e}});