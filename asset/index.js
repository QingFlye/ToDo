define("util/extend",[],function(){function e(e,t){e=e||{};var n=1;if(arguments.length===n)return e;for(;n<arguments.length;n++)if(t=arguments[n],null!=t)for(var i in t)if(t.hasOwnProperty(i)&&void 0!==t[i])e[i]=t[i];return e}return e}),define("util/Emitter",["require","./extend"],function(require){function e(){}var t=require("./extend");return e.prototype.emit=function(e){if(!this._events)this._events={};var t=this._events[e];if(!t)return!1;for(var n=arguments.length,i=new Array(n-1),r=1;n>r;r++)i[r-1]=arguments[r];var o=t.slice();for(n=o.length,r=0;n>r;r++)o[r].apply(this,i);return!0},e.prototype.on=function(e,t){if("function"!=typeof t)throw new TypeError("listener must be a function");if(!this._events)this._events={};var n=this;return e.replace(/\S+/g,function(e){if(!n._events[e])n._events[e]=[];n._events[e].push(t)}),this},e.prototype.off=function(e,t){if("function"!=typeof t)throw new TypeError("listener must be a function");if(!this._events||!this._events[e])return this;for(var n=this._events[e],i=n.length,r=-1,o=i;o-->0;)if(n[o]===t||n[o].listener&&n[o].listener===t){r=o;break}if(0>r)return this;if(0===n.length)delete this._events[e];return this},e.mixin=function(n){return t(n,e.prototype)},e}),define("util/type",[],function(){function e(e){if(null==e)return e+"";if("object"==typeof e||"function"==typeof e)return t[n.call(e)]||"object";else return typeof e}var t={},n=t.toString;return"Boolean Number String Function Array Date RegExp Object Error".replace(/\w+/g,function(e){t["[object "+e+"]"]=e.toLowerCase()}),e}),define("util/each",["require","./type"],function(require){function e(e,n){var i,r;if("array"===t(e)){r=0;for(var o=e.length;o>r&&(i=n.call(e[r],r,e[r]),i!==!1);r++);}else for(r in e)if(e.hasOwnProperty(r))if(i=n.call(e[r],r,e[r]),i===!1)break;return e}var t=require("./type");return e}),define("util/guid",[],function(){function e(e){return(e||"")+t++}var t=1;return e}),define("util/clone",["require","./each","./type"],function(require){function e(r,o){if(null==r||"object"!=typeof r)return r;var a=n(r);if(i.test(a))return r.valueOf();if("date"===a)return new Date(+r);var s="array"===a?[]:"error"===a?new Error:{};return t(r,function(t,n){s[t]=o?e(n,!0):n}),s}var t=require("./each"),n=require("./type"),i=/^(?:number|string|boolean|regexp)$/;return e}),define("util/expando",[],function(){function e(e){return e+t+n}var t=+new Date,n=(Math.random()+"").slice(2);return e}),define("data/storage",[],function(){var e=window.localStorage,t={};return{getItem:function(n){return n in t?t[n]:JSON.parse(e.getItem(n))},setItem:function(n,i){if(null==i)i=null;e.setItem(n,JSON.stringify(t[n]=i))},removeItem:function(n){delete t[n],e.removeItem(n)},clear:function(){t={},e.clear()}}}),define("data/category",["require","../util/guid","../util/each","../util/extend","../util/clone","../util/expando","../util/Emitter","./storage"],function(require){function e(){f={},d={},n(l,function(e,t){f[t.id]=e;var n=t.parent;if(null==n)d[t.id]=d[t.id]||{};else d[n]=d[n]||{},d[n][t.id]=!0}),c.setItem("categories",l)}var t=require("../util/guid"),n=require("../util/each"),i=require("../util/extend"),r=require("../util/clone"),o=require("../util/expando"),a=require("../util/Emitter"),s={};a.mixin(s);var c=require("./storage"),u=o("category").slice(0,17),l=c.getItem("categories")||[{id:"category0",title:"默认分类",readonly:!0,order:0,parent:null}],f=null,d=null;return e(),s.item=function(e){return l[f[e]]},s.insert=function(n,i){var o={id:t(u),title:n,readonly:!1,order:0,parent:i||null};return l.push(o),e(),s.emit("add",o=r(o)),o},s.update=function(t,n){t=t||n.id;var o=f[t],a=l[o];if(null==o)l.push(n);else n=l[o]=i({},a,n);if(e(),null==o)s.emit("add",n=r(n));else s.emit("update",n=r(n),a);return n},s.remove=function(t){var i=f[t];if(null==i)return null;var r=[i];n(d[t],function(e){r.push(f[e])}),r.sort(function(e,t){return t-e});var o=[];return n(r,function(e,t){o.push.apply(o,l.splice(t,1))}),e(),s.emit("remove",o),o},s.query=function(e,t,i){var o=[];if(e)n(d[e],function(e){o.push(r(l[f[e]]))});else if(!i)o=r(l,!0);else n(d,function(e){var n=r(l[f[e]]);n.children=s.query(e,t,!1),o.push(n)});if(t)o.sort(function(e,t){var n=t.order-e.order,i=+e.id.slice(11),r=+t.id.slice(11);return n?n:r-i});return o},s}),define("data/task",["require","../util/guid","../util/each","../util/clone","../util/expando","../util/extend","../util/Emitter","./category","./storage"],function(require){function e(){d={},p={},h={},n(f,function(e,t){d[t.id]=e;var n=t.category;p[n]=p[n]||{},p[n][t.id]=!0,h[n]=h[n]||0,h[n]++}),u.setItem("tasks",f)}var t=require("../util/guid"),n=require("../util/each"),i=require("../util/clone"),r=require("../util/expando"),o=require("../util/extend"),a=require("../util/Emitter"),s=require("./category"),c={};a.mixin(c);var u=require("./storage"),l=r("task").slice(0,17),f=u.getItem("tasks")||[],d=null,p=null,h=null;return e(),c.item=function(e){return f[d[e]]},c.insert=function(n,r,o,a){var s={id:t(l),title:n||"",date:r||"",content:o||"",finished:!1,category:a||"category0"};return f.push(s),e(),c.emit("add",s=i(s)),s},c.update=function(t,n){var r=t||n.id,a=d[r],s=f[a];if(null==a)f.push(n);else n=f[a]=o({},s,n);return e(),c.emit("update",n=i(n),s),n},c.remove=function(t){var n=d[t];if(null==n)return null;var i=f.splice(n,1)[0];return e(),c.emit("remove",i),i},c.query=function(e,t,r,o){function a(e){var n=f[d[e]];if(!("finished"===t&&!n.finished||"unfinished"===t&&n.finished))c.push(i(n))}var c=[];if(!r||!e)n(e?p[e]:d,a);else{var u=s.item(e);if(null===u.parent)n(p[e],a);var l=s.query(e,!1,!1);n(l,function(e){n(p[e],a)})}if(o)c.sort(function(e,t){var n=e.date.split("-"),i=t.date.split("-"),r=new Date(i[0],i[1],i[2])-new Date(n[0],n[1],n[2]);return r?r:t.id.localeCompare(e.id)});return c},c.count=function(e){return e?h[e]||0:f.length},s.on("remove",function(t){n(t,function(e,t){var i=c.query(t.id,null,!1);n(i,function(e,t){f[d[t.id]].category=t.category="category0"})}),e()}),c}),define("category/model",["require","../util/each","../util/Emitter","../data/category","../data/task"],function(require){var e=require("../util/each"),t=require("../util/Emitter"),n=require("../data/category"),i=require("../data/task"),r={init:function(){r.emit("change",null)},setCurrentCategory:function(e){if(r.current!==e)r.current=e,r.emit("change",e)},getCategories:function(){var t=!1,o=!1;if(r.current){var a=n.item(r.current);if(a.parent)t=a.parent,o=a.id;else t=a.id}var s={count:0,currentFirst:t,currentSecond:o,categories:n.query(null,!0,!0)};return e(s.categories,function(t,n){n.count=i.count(n.id),e(n.children,function(e,t){t.count=i.count(t.id),n.count+=t.count}),s.count+=n.count}),s},addCategory:function(e){var t=r.current;if(!t||"category0"===t)n.insert(e,null);else{var i=n.item(t);n.insert(e,i.parent||i.id)}r.emit("change")},renameCategory:function(e,t){n.update(e,{title:t}),r.emit("change")},removeCategory:function(t){var i=n.remove(t),o=r.current;if(e(i,function(e,t){if(t.id===r.current)r.current=null}),o!==r.current)r.emit("change",r.current);else r.emit("change")},moveTaskOrCategory:function(e,t){if(/^task/i.test(e))return void i.update(e,{category:t});var o=n.item(t);if(t=o.parent||o.id,"category0"!==t)n.update(e,{parent:t}),r.emit("change",r.current)}};return i.on("add remove",function(){r.emit("change")}),i.on("update",function(e,t){if(!t||e.category!==t.category)r.emit("change")}),t.mixin(r),r}),function(e){function t(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}function n(){this.raw=[],this.length=0}function i(){return"___"+D++}function r(e,t){var n=new Function;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function o(e){return B[e]}function a(e){return'"'+e.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function s(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return"\\"+e})}function c(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,n){return t[n-0+1]})}function u(e){return e=e.replace(/^\s*\*/,""),c('gv({0},["{1}"])',a(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return"."+t}).split(".").join('","'))}function l(e,t,n,i,r,o){for(var a=n.length,s=e.split(t),c=0,u=[],l=0,f=s.length;f>l;l++){var d=s[l];if(l){var p=1;for(c++;;){var h=d.indexOf(n);if(0>h){u.push(c>1&&p?t:"",d);break}if(c=i?c-1:0,u.push(c>0&&p?t:"",d.slice(0,h),c>0?n:""),d=d.slice(h+a),p=0,0===c)break}if(0===c)r(u.join("")),o(d),u=[]}else d&&o(d)}if(c>0&&u.length>0)o(t),o(u.join(""))}function f(e,t,n){var i,r=[],o=t.options,s="",c="",d="",p="";if(n)s="ts(",c=")",d=S,p=O,i=o.defaultFilter;return l(e,o.variableOpen,o.variableClose,1,function(e){if(n&&e.indexOf("|")<0&&i)e+="|"+i;var o=e.indexOf("|"),a=(o>0?e.slice(0,o):e).replace(/^\s+/,"").replace(/\s+$/,""),l=o>0?e.slice(o+1):"",h=0===a.indexOf("*"),g=[h?"":s,u(a),h?"":c];if(l){l=f(l,t);for(var m=l.split("|"),v=0,y=m.length;y>v;v++){var E=m[v];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(E)){if(g.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)g.push(",",RegExp.$3);g.push(")")}}}r.push(d,g.join(""),p)},function(e){r.push(d,n?a(e):e,p)}),r.join("")}function d(e,t){this.value=e,this.engine=t}function p(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[]}function h(e,t){var n=e.stack,i=t?n.find(function(e){return e instanceof t}):n.bottom();if(i){for(var r;(r=n.top())!==i;){if(!r.autoClose)throw new Error(r.type+" must be closed manually: "+r.value);r.autoClose(e)}i.close(e)}return i}function g(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.master=RegExp.$3,this.name=RegExp.$1,p.call(this,e,t),this.blocks={}}function m(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,p.call(this,e,t),this.cloneProps=["name"]}function v(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,p.call(this,e,t),this.cloneProps=["name","state","blocks"],this.blocks={}}function y(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.expr=RegExp.$2,p.call(this,e,t),this.cloneProps=["name","expr"]}function E(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,p.call(this,e,t),this.cloneProps=["name","args"]}function w(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.name=RegExp.$1,this.args=RegExp.$3,p.call(this,e,t),this.cloneProps=["name","args"]}function k(e,t){var n=new RegExp(c("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",s(t.options.variableOpen),s(t.options.variableClose)),"i");if(!n.test(e))throw new Error("Invalid "+this.type+" syntax: "+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,p.call(this,e,t),this.cloneProps=["list","item","index"]}function x(e,t){p.call(this,e,t)}function b(e,t){x.call(this,e,t)}function $(e,t){p.call(this,e,t)}function C(e,t){t.target=e;var n=t.engine,i=e.name;if(n.targets[i])switch(n.options.namingConflict){case"override":n.targets[i]=e,t.targets.push(i);case"ignore":break;default:throw new Error("Target exists: "+i)}else n.targets[i]=e,t.targets.push(i)}function T(e,t){M[e]=t,t.prototype.type=e}function R(e){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.config(e),this.targets={},this.filters=t({},P)}function I(e,t){function i(){var e;if(f.length>0&&(e=f.join(""))){var n=new d(e,t);if(n.beforeAdd(u),c.top().addChild(n),f=[],t.options.strip&&u.current instanceof p)n.value=e.replace(/^[\x20\t\r]*\n/,"");u.current=n}}var r,o=t.options.commandOpen,a=t.options.commandClose,s=t.options.commandSyntax,c=new n,u={engine:t,targets:[],stack:c,target:null},f=[];return l(e,o,a,0,function(e){var n=s.exec(e);if(n&&(r=M[n[2].toLowerCase()])&&"function"==typeof r){i();var c=u.current;if(t.options.strip&&c instanceof d)c.value=c.value.replace(/\r?\n[\x20\t]*$/,"\n");if(n[1])c=h(u,r);else{if(c=new r(n[3],t),"function"==typeof c.beforeOpen)c.beforeOpen(u);c.open(u)}u.current=c}else if(!/^\s*\/\//.test(e))f.push(o,e,a);r=null},function(e){f.push(e)}),i(),h(u),u.targets}n.prototype={push:function(e){this.raw[this.length++]=e},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(e){for(var t=this.length;t--;){var n=this.raw[t];if(e(n))return n}}};var D=178245,B={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},P={html:function(e){return e.replace(/[&<>"']/g,o)},url:encodeURIComponent,raw:function(e){return e}},A='var r="";',S="r+=",O=";",L="return r;";if("undefined"!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)A="var r=[],ri=0;",S="r[ri++]=",L='return r.join("");';d.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return"";else return f(e,this.engine,1)},clone:function(){return this}},p.prototype={addChild:function(e){this.children.push(e)},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this)},close:function(e){if(e.stack.top()===this)e.stack.pop()},getRendererBody:function(){for(var e=[],t=this.children,n=0;n<t.length;n++)e.push(t[n].getRendererBody());return e.join("")},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,n=this.children.length;n>t;t++)e.addChild(this.children[t].clone());for(var t=0,n=this.cloneProps.length;n>t;t++){var i=this.cloneProps[t];e[i]=this[i]}return e}};var N='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';r(g,p),r(m,p),r(v,p),r(y,p),r(E,p),r(w,p),r(k,p),r(x,p),r(b,x),r($,x);var q={READING:1,READED:2,APPLIED:3,READY:4};v.prototype.applyMaster=g.prototype.applyMaster=function(e){function t(e){var i=e.children;if(i instanceof Array)for(var r=0,o=i.length;o>r;r++){var a=i[r];if(a instanceof m&&n[a.name])a=i[r]=n[a.name];t(a)}}if(this.state>=q.APPLIED)return 1;var n=this.blocks,i=this.engine.targets[e];if(i&&i.applyMaster(i.master))return this.children=i.clone().children,t(this),this.state=q.APPLIED,1;else return void 0},g.prototype.isReady=function(){function e(i){for(var r=0,o=i.children.length;o>r;r++){var a=i.children[r];if(a instanceof v){var s=t.targets[a.name];n=n&&s&&s.isReady(t)}else if(a instanceof p)e(a)}}if(this.state>=q.READY)return 1;var t=this.engine,n=1;if(this.applyMaster(this.master))return e(this),n&&(this.state=q.READY),n;else return void 0},g.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function("data","engine",[N,A,this.getRendererBody(),L].join("\n")),t=this.engine;return this.renderer=function(n){return e(n,t)},this.renderer}return null},g.prototype.open=function(e){h(e),p.prototype.open.call(this,e),this.state=q.READING,C(this,e)},y.prototype.open=w.prototype.open=function(e){e.stack.top().addChild(this)},m.prototype.open=function(e){p.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this},b.prototype.open=function(e){var t=new $;t.open(e);var n=h(e,x);n.addChild(this),e.stack.push(this)},$.prototype.open=function(e){var t=h(e,x);t.addChild(this),e.stack.push(this)},v.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,p.prototype.open.call(this,e),this.state=q.READING,e.imp=this},w.prototype.close=y.prototype.close=function(){},v.prototype.close=function(e){p.prototype.close.call(this,e),this.state=q.READED,e.imp=null},g.prototype.close=function(e){p.prototype.close.call(this,e),this.state=this.master?q.READED:q.APPLIED,e.target=null},v.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var n in this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(e)},w.prototype.beforeOpen=v.prototype.beforeOpen=y.prototype.beforeOpen=k.prototype.beforeOpen=E.prototype.beforeOpen=m.prototype.beforeOpen=x.prototype.beforeOpen=d.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new g(i(),e.engine);t.open(e)}},v.prototype.getRendererBody=function(){return this.applyMaster(this.name),p.prototype.getRendererBody.call(this)},w.prototype.getRendererBody=function(){return c("{0}engine.render({2},{{3}}){1}",S,O,a(this.name),f(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,n){return(t||"")+a(n)+":"}))},y.prototype.getRendererBody=function(){if(this.expr)return c("v[{0}]={1};",a(this.name),f(this.expr,this.engine));else return""},x.prototype.getRendererBody=function(){return c("if({0}){{1}}",f(this.value,this.engine),p.prototype.getRendererBody.call(this))},$.prototype.getRendererBody=function(){return c("}else{{0}",p.prototype.getRendererBody.call(this))},k.prototype.getRendererBody=function(){return c('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',i(),f(this.list,this.engine),a(this.index||i()),a(this.item),i(),i(),p.prototype.getRendererBody.call(this))},E.prototype.getRendererBody=function(){var e=this.args;return c("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",A,L,S,O,p.prototype.getRendererBody.call(this),a(this.name),e?","+f(e,this.engine):"")};var M={};T("target",g),T("block",m),T("import",v),T("use",w),T("var",y),T("for",k),T("if",x),T("elif",b),T("else",$),T("filter",E),R.prototype.config=function(e){t(this.options,e)},R.prototype.compile=R.prototype.parse=function(e){if(e){var t=I(e,this);if(t.length)return this.targets[t[0]].getRenderer()}return new Function('return ""')},R.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0},R.prototype.render=function(e,t){var n=this.getRenderer(e);if(n)return n(t);else return""},R.prototype.addFilter=function(e,t){if("function"==typeof t)this.filters[e]=t};var _=new R;if(_.Engine=R,"object"==typeof exports&&"object"==typeof module)exports=module.exports=_;else if("function"==typeof define&&define.amd)define("etpl/main",[],_);else e.etpl=_}(this),define("etpl",["etpl/main"],function(e){return e}),define("util/matches",[],function(){function e(e){return e.replace(c,u)}function t(t){for(var n,i,r=[];t;){for(var o in f)if(f.hasOwnProperty(o)&&(i=f[o].exec(t))){if(n=i.shift(),"ATTR"===o)if(i[0]=e(i[0]),i[2]=e(i[2]||i[3]||i[4]||""),i=i.slice(0,3),!i)throw new Error(n+"解析失败");r.push({matched:n,value:i,type:o}),t=t.slice(n.length)}if(!n)break}if(t)throw new Error(t+"解析失败");return r}function n(e){if(e.length>1)return function(t,n){for(var i=e.length;i--;)if(!e[i](t,n))return!1;return!0};else return e[0]}function i(e){for(var t=[],i=0,r=e.length;r>i;i++){var o=e[i];t.push(d[o.type].apply(null,o.value))}return n(t)}function r(e){return i(t(e))}function o(e,t){if(!e||!e.nodeType||1!==e.nodeType||!t)return!1;t=t.replace(l,"$1");var n=p[t]||(p[t]=r(t));return n(e)}var a="[\\x20\\t\\r\\n\\f]",s="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",c=new RegExp("\\\\([\\da-f]{1,6}"+a+"?|("+a+")|.)","ig"),u=function(e,t,n){var i="0x"+t-65536;if(isNaN(i)||n)return t;if(0>i)return String.fromCharCode(i+65536);else return String.fromCharCode(i>>10|55296,1023&i|56320)},l=new RegExp("^"+a+"+|((?:^|[^\\\\])(?:\\\\.)*)"+a+"+$","g"),f={ID:new RegExp("^#("+s+")"),CLASS:new RegExp("^\\.("+s+")"),TAG:new RegExp("^("+s+"|[*])"),ATTR:new RegExp("^\\["+a+"*("+s+")(?:"+a+"*([*^$|!~]?=)"+a+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+s+"))|)"+a+"*\\]")},d={ATTR:function(e,t,n){if("~="===t)var i=new RegExp(a+n+a);return function(r){var o=r.getAttribute(e);if(null==o)return"!="===t;if(!t)return!0;switch(o+="",t){case"=":return o===n;case"!=":return o!==n;case"^=":return n&&0===o.indexOf(n);case"*=":return n&&o.indexOf(n)>-1;case"$=":return n&&o.slice(-n.length)===n;case"~=":return i.test(" "+o+" ");case"|=":return o===n||o.slice(0,n.length+1)===n+"-";default:return!1}}},CLASS:function(e){var t=new RegExp("(^|"+a+")"+e+"("+a+"|$)");return function(e){return t.test("string"==typeof e.className&&e.className||"")}},ID:function(t){var n=e(t);return function(e){return e.getAttribute("id")===n}},TAG:function(t){var n=e(t).toLowerCase();return"*"===t?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===n}}},p={};return o}),define("util/bind",["require","./matches"],function(require){function e(){return!1}function t(){return!0}function n(e,n){if(e&&e.type){if(this.originEvent=e,this.type=e.type,e.defaultPrevent||void 0===e.defaultPrevented&&e.returnValue===!1)this.isDefaultPrevented=t}else this.type=e;for(var i in n)if(n.hasOwnProperty(i))this[i]=n[i];this.timeStemp=e&&e.timeStemp||(new Date).getTime()}function i(e){if(e.isMiniEvent)return e;var t=e.type,i=l[t],r=new n(e);if(!i){if(a.test(t))i=f;else if(s.test(t))i=d;else if(c.test(t))i=p;else i={};l[t]=i}for(var o=i.props?u.concat(i.props):u,g=o.length;g--;){var m=o[g];r[m]=e[m]}if(!r.target)r.target=e.srcElement||document;if(3===r.target.nodeType)r.target=e.target.parent;if("drop"===t)r.dragTarget=h;return i.filter?i.filter(r,e):r}function r(e,t,n,r){var a=function(a){a=i(a);var s=a.target;if(r)for(;s&&s!==e&&!a.isPropagationStopped();){if(1===s.nodeType&&o(s,r))n.call(s,a);s=s.parentNode}else n.call(e,a);if(a.dragTarget&&/^(?:dragstart|dragend|drag)$/i.test(t))h=a.dragTarget};if(e.addEventListener)e.addEventListener(t,a,!1);else e.attachEvent("on"+t,a);return a}var o=require("./matches");n.prototype={constructor:n,isDefaultPrevented:e,isPropagationStopped:e,isImmediatePropagationStopped:e,preventDefault:function(){var e=this.originEvent;if(this.isDefaultPrevented=t,e)if(e.preventDefault)e.preventDefault();else e.returnValue=!1},stopPropagation:function(){var e=this.originEvent;if(this.isPropagationStopped=t,e)if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0},stopImmediatePropagation:function(){var e=this.originEvent;if(this.isImmediatePropagationStopped=t,e&&e.stopImmediatePropagation)e.stopImmediatePropagation();this.stopPropagation()}};var a=/^key/,s=/^(?:mouse|pointer|contextmenu)|click|wheel/i,c=/^touch/,u="altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),l={},f={props:"char charCode key keyCode".split(" "),filter:function(e,t){if(!e.which)e.which=null!=t.keyCode?t.keyCode:t.charCode;return e}},d={props:"button buttons clientX clientY pageX pageY fromElement offsetX offsetY screenX screenY toElement".split(" "),filter:function(e,t){var n=t.button;if(null==e.pageX&&null!=e.clientX){var i=e.target.ownerDocument||document,r=i.documentElement,o=i.body;e.pageX=t.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)}if(!e.which&&void 0!==n)switch(n){case 1:e.which=1;break;case 2:e.which=3;break;case 4:e.which=2;break;default:e.which=0}return e.wheelDelta=t.wheelDelta||((t.deltaY||t.detail)>0?-120:120),e}},p={props:d.props.concat("touches changedTouches".split(" "))},h=null;return r}),define("util/trim",[],function(){function e(e){return null==e?"":(e+"").replace(t,"")}var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return e}),define("util/class",["require","./trim"],function(require){function e(e,t){var n=t&&t.match(o);if(n){var a=e&&1===e.nodeType&&(e.className?(" "+e.className+" ").replace(r," "):" ");if(a){for(var s=0,c=n.length;c>s;s++){var u=n[s];if(a.indexOf(" "+u+" ")<0)a+=u+" "}var l=i(a);if(e.className!==l)e.className=l}}}function t(e,t){var n=t&&t.match(o);if(n){var a=e&&1===e.nodeType&&(e.className?(" "+e.className+" ").replace(r," "):" ");if(a){for(var s=0,c=n.length;c>s;s++){var u=n[s];if(a.indexOf(" "+u+" ")>=0)a=a.replace(" "+u+" "," ")}var l=t?i(a):"";if(e.className!==l)e.className=l}}}function n(e,t){return!!(1===e.nodeType&&(" "+e.className+" ").replace(r," ").indexOf(" "+t+" ")>=0)}var i=require("./trim"),r=/[\t\r\n\f]/g,o=/\S+/g;return{addClass:e,removeClass:t,hasClass:n}}),define("category/category.tpl",[],function(){return'<!-- target: category -->\n<h3 class="<!-- if: !${currentFirst}-->active<!--/if-->">所有任务(<span id="category-count">${count}</span>)</h3>\n<h4>全部分类</h4>\n<!-- for: ${categories} as ${group}-->\n<dl data-id="${group.id}" class="<!-- if: ${currentFirst} === ${group.id}-->active<!--/if-->">\n    <dt data-id="${group.id}" class="<!-- if: ${currentFirst} === ${group.id}  && !${currentSecond} -->active<!--/if-->">\n        <i class="iconfont icon-iconfontwenjianjiadakai"></i>\n        <span>${group.title}(<span>${group.count}</span>)</span>\n        <!-- if: !${group.readonly} -->\n        <a class="btn">删除<i class="iconfont icon-chahao"></i></a>\n        <!--/if-->\n    </dt>\n    <!-- for: ${group.children} as ${item} -->\n    <dd data-id="${item.id}" class="<!-- if: ${currentSecond} === ${item.id} -->active<!--/if-->" draggable="true">\n        <i class="iconfont icon-11"></i>\n        <span>${item.title}(<span>${item.count}</span>)</span>\n        <!-- if: !${item.readonly} -->\n        <a class="btn" href=javascript:void(0)>删除<i class="iconfont icon-chahao"></i></a>\n        <!--/if-->\n    </dd>\n    <!-- /for -->\n</dl>\n<!-- /for -->\n'}),define("dialog/category",["require","../util/bind","../util/class"],function(require){var e=require("../util/bind"),t=require("../util/class"),n=document.getElementById("category-note"),i=document.getElementById("dialog-category"),r=document.getElementById("mask"),o=document.getElementById("category-title"),a=document.getElementById("category-error"),s=null,c={show:function(e,c){s=c,t.removeClass(r,"hidden"),o.value=e||"",n.innerHTML=e?"重命名分类":"新增分类",a.innerHTML="",t.removeClass(i,"hidden");try{o.focus()}catch(u){}},hide:function(){t.addClass(i,"hidden"),t.addClass(r,"hidden")}};return e(i,"click",function(e){e.preventDefault(),c.hide()},"[data-role=close]"),e(i,"click",function(e){e.preventDefault();var t=o.value;if(!t)return void(a.innerHTML="分类标题必须填写");if(t.length>10)return void(a.innerHTML="分类标题不能超过10个字符");else return c.hide(),void(s&&s(o.value))},"[data-role=confirm]"),e(i.getElementsByTagName("form")[0],"submit",function(e){e.preventDefault(),c.hide(),s&&s(o.value)}),c}),define("dialog/confirm",["require","../util/bind","../util/class"],function(require){var e=require("../util/bind"),t=require("../util/class"),n=document.getElementById("confirm-title"),i=document.getElementById("confirm"),r=document.getElementById("mask"),o=null,a={show:function(e,a){o=a,t.removeClass(r,"hidden"),n.innerHTML=e||"请确认",t.removeClass(i,"hidden")},hide:function(){t.addClass(i,"hidden"),t.addClass(r,"hidden")}};return e(i,"click",function(e){e.preventDefault(),a.hide()},"[data-role=close]"),e(i,"click",function(e){e.preventDefault(),a.hide(),o&&o()},"[data-role=confirm]"),a}),define("category/view",["require","../util/Emitter","etpl","../util/bind","../util/class","./category.tpl","../dialog/category","../dialog/confirm"],function(require){function e(){if(!o.hasClass(this,"active"))c.emit("change",this.getAttribute("data-id"))}function t(e){e.preventDefault();var t=e.dragTarget;if(t)if(t.parentNode!==this){var n=t.getAttribute("data-id");if(n){var i=this.getAttribute("data-id");c.emit("move",n,i)}}}var n=require("../util/Emitter"),i=require("etpl"),r=require("../util/bind"),o=require("../util/class"),a=require("./category.tpl");i.compile(a);var s=document.getElementById("category-items"),c={draw:function(e){s.innerHTML=i.render("category",e)}};n.mixin(c);var u=require("../dialog/category");r(document.getElementById("category-add"),"click",function(){u.show("",function(e){c.emit("add",e)})}),r(s,"click",e,"dt"),r(s,"click",e,"dd"),r(s,"click",e,"h3");var l=require("../dialog/confirm");if(r(s,"click",function(e){e.stopPropagation();var t=this;l.show("删除不可恢复，确定要删除吗？",function(){c.emit("remove",t.parentNode.getAttribute("data-id"))})},".btn"),r(s,"drag",function(e){e.dragTarget=this},"dd"),r(s,"dragenter",function(e){e.preventDefault()},"dl"),r(s,"dragover",function(e){e.preventDefault()},"dl"),r(s,"drop",t,"dd"),r(s,"drop",t,"dt"),"dragDrop"in s)r(s,"mousemove",function(e){var t=e.target;if("dragDrop"in t)t.dragDrop()},"dd");return c}),define("category/controller",["require","../util/Emitter","./model","./view"],function(require){var e=require("../util/Emitter"),t=require("./model"),n=require("./view"),i={init:function(){t.init()}};return e.mixin(i),n.on("add",function(e){t.addCategory(e)}),n.on("change",function(e){t.setCurrentCategory(e)}),n.on("remove",function(e){t.removeCategory(e)}),n.on("move",function(e,n){t.moveTaskOrCategory(e,n)}),t.on("change",function(e){var r=t.getCategories();if(n.draw(r),"undefined"!=typeof e)i.emit("change",e)}),i}),define("detail/model",["require","../util/extend","../data/task","../util/Emitter"],function(require){var e=require("../util/extend"),t=require("../data/task"),n=require("../util/Emitter"),i={isedit:!1,category:null,task:null,initWithTask:function(e){i.isedit=!1,i.task=t.item(e),i.emit("change",i.task,i.isedit,!1)},initWithCategory:function(e){i.isedit=!0,i.category=e||"category0";var t=new Date,n=("0000"+t.getFullYear()).slice(-4),r=("00"+(t.getMonth()+1)).slice(-2),o=("00"+t.getDate()).slice(-2);i.task={id:"",title:"",date:n+"-"+r+"-"+o.slice(-2),content:""},i.emit("change",i.task,i.isedit,!0)},setEdit:function(e){i.isedit=e,i.emit("change",i.task,i.isedit,!1)},deleteTask:function(){t.remove(i.task.id)},finishTask:function(){i.task.finished=!0,t.update(i.task.id,i.task)},saveTask:function(n){i.isedit=!1;var r=i.task,o=e({},i.task,n);if(o.id){if(i.task=t.update(o.id,o),o.date===r.date&&o.title===r.title)i.emit("change",i.task,i.isedit,!1)}else i.task=t.insert(o.title,o.date,o.content,i.category),i.emit("change",i.task,i.isedit,!1)}};return n.mixin(i),i}),define("detail/detail.tpl",[],function(){return'<!-- target: task -->\n<h1>\n    <!-- if: ${isedit} -->\n    <input placeholder="请输入任务名称" value="${title}" id="form-title">\n    <span class="form-error" id="form-title-error"></span>\n    <!-- else -->\n    ${title}\n    <!-- /if-->\n    <!-- if: !${isedit} -->\n    <a class="btn" data-role="delete">删除<i class="iconfont icon-chahao"></i></a>\n    <!-- /if-->\n    <!-- if: !${isedit} && !${finished} -->\n    <a class="btn" data-role="edit">编辑<i class="iconfont icon-bianji"></i></a>\n    <a class="btn" data-role="finish">完成<i class="iconfont icon-wancheng"></i></a>\n    <!-- /if-->\n</h1>\n<h2 class="b-shadow">\n    <!-- if: ${isedit} -->\n    <input placeholder="请输入任务日期" value="${date}" id="form-date">\n    <span class="form-error" id="form-date-error"></span>\n    <!-- else -->\n    任务日期：${date}\n    <!-- /if-->\n</h2>\n<!-- if: ${isedit} -->\n<textarea placeholder="请输入任务详情" id="form-content">${content}</textarea>\n<br/>\n<span class="form-error" id="form-content-error"></span>\n<!-- else -->\n<section>\n    <!-- for: ${list} as ${item} -->\n    <p>${item}</p>\n    <!-- /for -->\n</section>\n<!-- /if-->\n<!-- if: ${isedit} -->\n<div>\n    <input class="button" type="button" value="确定" data-role="confirm">\n    <!-- if: ${id} -->\n    <input class="button" type="button" value="取消" data-role="cancel">\n    <!-- /if-->\n</div>\n<!-- /if-->\n'}),define("detail/view",["require","../util/Emitter","etpl","./detail.tpl","../util/bind","../dialog/confirm"],function(require){var e=require("../util/Emitter"),t=require("etpl"),n=require("./detail.tpl");t.compile(n);var i=require("../util/bind"),r=document.getElementById("detail"),o=require("../dialog/confirm"),a={draw:function(e,n,i){if(!e)return void(r.innerHTML="");
else return void(r.innerHTML=t.render("task",{isnew:i,isedit:n,title:e.title||"",finished:e.finished||!1,date:e.date||"",content:e.content||"",list:e.content&&e.content.split(/\r?\n/)||[]}))},editConfirm:function(e){o.show("当前正在编辑任务，是否放弃？",e)}};return e.mixin(a),i(r,"click",function(e){e.preventDefault(),a.emit("edit")},"[data-role=edit]"),i(r,"click",function(e){e.preventDefault(),o.show("完成的任务无法再次编辑，是否确认",function(){a.emit("finish")})},"[data-role=finish]"),i(r,"click",function(e){e.preventDefault(),o.show("删除的任务无法恢复，是否确认删除",function(){a.emit("delete")})},"[data-role=delete]"),i(r,"click",function(e){e.preventDefault();var t=document.getElementById("form-title").value||"",n=document.getElementById("form-date").value||"",i=document.getElementById("form-content").value||"",r=!0;if(!t||t.length>20)document.getElementById("form-title-error").innerHTML=t?"任务标题不能超过20字":"任务标题必需输入",r=!1;else document.getElementById("form-title-error").innerHTML="";if(!n)document.getElementById("form-date-error").innerHTML="任务日期必须输入！",r=!1;else if(!/^\d{4}-\d{2}-\d{2}$/.test(n))document.getElementById("form-date-error").innerHTML="任务日期的格式应当为yyyy-MM-dd！",r=!1;else document.getElementById("form-date-error").innerHTML="";if(!i)document.getElementById("form-content-error").innerHTML="任务内容必须输入！",r=!1;else if(i.length>1e3)document.getElementById("form-content-error").innerHTML="任务内容不能超过1000字！",r=!1;else document.getElementById("form-content-error").innerHTML="";if(r)o.show("是否保存任务",function(){var e=document.getElementById("form-title").value||"",t=document.getElementById("form-date").value||"",n=document.getElementById("form-content").value||"";a.emit("confirm",{title:e,date:t,content:n})})},"[data-role=confirm]"),i(r,"click",function(e){e.preventDefault(),o.show("是否放弃当前输入的内容",function(){a.emit("cancel")})},"[data-role=cancel]"),a}),define("detail/controller",["require","../util/Emitter","./model","./view"],function(require){var e=require("../util/Emitter"),t=require("./model"),n=require("./view"),i={init:function(e){if(t.isedit)n.editConfirm(function(){t.isedit=!1,t.initWithTask(e)});else t.initWithTask(e)},add:function(e){if(t.isedit)n.editConfirm(function(){t.isedit=!1,t.initWithCategory(e)});else t.initWithCategory(e)}};return e.mixin(i),n.on("edit",function(){t.setEdit(!0)}),n.on("cancel",function(){t.setEdit(!1)}),n.on("finish",function(){t.finishTask()}),n.on("delete",function(){t.deleteTask()}),n.on("confirm",function(e){t.saveTask(e)}),t.on("change",function(e,t,i){n.draw(e,t,i)}),i}),define("list/model",["require","../util/each","../data/task","../util/Emitter"],function(require){var e=require("../util/each"),t=require("../data/task"),n=require("../util/Emitter"),i={type:"all",category:null,setType:function(e){i.type=e,i.emit("change")},setCategory:function(e){i.category=e,i.emit("change")},getCategory:function(){return i.category||"category0"},setCurrentTask:function(e){if(i.currentTask!==e)i.currentTask=e,i.emit("current",e)},getCurrentTask:function(){return i.currentTask},getTasks:function(){var n=i.currentTask,r=t.query(i.category,i.type,!0,!0);if(r.length)if(!i.currentTask)i.currentTask=r[0].id;else{var o=!1;if(e(r,function(){if(this.id===i.currentTask)return o=!0,!1;else return void 0}),!o)i.currentTask=r[0].id}else i.currentTask=null;if(n!==i.currentTask)i.emit("current",i.currentTask);return{type:i.type,current:i.currentTask,list:r}}};return n.mixin(i),t.on("add",function(e){if(i.currentTask=e.id,"finished"===i.type)i.type="all";i.emit("change")}),t.on("remove",function(){i.emit("change")}),t.on("update",function(e,t){if(!t||e.date!==t.date||e.title!==t.title||e.category!==t.category||e.finished!==t.finished)i.emit("change")}),i}),define("list/list.tpl",[],function(){return'<!-- target: list -->\n\n<!-- var: date = null -->\n<!-- for: ${list} as ${item} -->\n<!-- if: ${date} !== ${item.date} -->\n<dt>${item.date}</dt>\n<!-- var: date = ${item.date} -->\n<!-- /if-->\n<!-- if: ${item.id} === ${current} -->\n<dd draggable="true" data-id="${item.id}" class="active">${item.title}</dd>\n<!-- else -->\n<dd draggable="true" data-id="${item.id}">${item.title}</dd>\n<!-- /if-->\n<!-- /for -->\n'}),define("list/view",["require","../util/Emitter","etpl","./list.tpl","../util/bind","../util/class"],function(require){var e=require("../util/Emitter"),t=require("etpl"),n=require("./list.tpl");t.compile(n);var i=require("../util/bind"),r=require("../util/class"),o=document.getElementById("list-items"),a=document.getElementById("list-type"),s={draw:function(e){o.innerHTML=t.render("list",e);for(var n=a.firstChild;n;n=n.nextSibling)if("SPAN"===n.nodeName)if(n.getAttribute("data-role")===e.type)r.addClass(n,"active");else r.removeClass(n,"active")}};if(e.mixin(s),i(o,"click",function(){if(!r.hasClass(this,"active")){for(var e=this.parentNode.firstChild;e;e=e.nextSibling)if("DD"===e.nodeName)if(e===this)r.addClass(e,"active");else r.removeClass(e,"active");s.emit("change",this.getAttribute("data-id"))}},"dd"),i(a,"click",function(){if(!r.hasClass(this,"active")){for(var e=a.firstChild;e;e=e.nextSibling)if("SPAN"===e.nodeName)if(e===this)r.addClass(e,"active");else r.removeClass(e,"active");s.emit("type",this.getAttribute("data-role"))}},"span"),i(document.getElementById("list-add"),"click",function(){s.emit("add")}),i(o,"drag",function(e){e.dragTarget=this},"dd"),"dragDrop"in o)i(o,"mousemove",function(e){var t=e.target;if("dragDrop"in t)t.dragDrop()},"dd");return s}),define("list/controller",["require","../util/Emitter","./model","./view"],function(require){var e=require("../util/Emitter"),t=require("./model"),n=require("./view"),i={init:function(e){t.setCategory(e)}};return e.mixin(i),i.init=function(e){t.setCategory(e)},n.on("add",function(){i.emit("add",t.getCategory())}),n.on("type",function(e){t.setType(e)}),n.on("change",function(e){t.setCurrentTask(e)}),t.on("change",function(){var e=t.getTasks();n.draw(e)}),t.on("current",function(e){i.emit("change",e)}),i}),define("index",["require","./category/controller","./detail/controller","./list/controller"],function(require){function e(){t.on("change",function(e){i.init(e)}),i.on("change",function(e){n.init(e)}),i.on("add",function(e){n.add(e)}),t.init()}var t=require("./category/controller"),n=require("./detail/controller"),i=require("./list/controller");return{init:e}});